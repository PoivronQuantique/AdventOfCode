
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Text.RegularExpressions;

namespace AdventOfCode.Jours
{
    public class Jour_12 : Jour_abs
    {
        #region Enumerables
        #endregion

        #region Propriétés
        private Springs SpringMap = new Springs();
        private Springs SpringMapPt2 = new Springs();
        #endregion

        #region Constructeur
        public Jour_12(bool debug = false):base(debug)
        {
            #region Input Data
            string InputData = ".#??..#??.?. 3,1,1,1\r\n???.##??#??????#???# 1,13,1\r\n.??#.?#??#????#?? 2,4,1,1,1\r\n???#??#.???#.?#??#?# 4,2,1,2,1,4\r\n????#?##???#.??.? 2,2,6,1\r\n.?????#???.###.##? 7,3,2\r\n.###?..#??????#???? 4,8,1\r\n??????????????? 1,1,1,2,1\r\n???.????????#? 1,3,1,1\r\n???.#..?#.?#?#??#?. 2,1,1,5,1\r\n.?..??#.????. 1,3,1,2\r\n.#?.??#?????##.# 1,2,1,3,1\r\n?###????.#?? 5,1,2\r\n?#??.????? 2,4\r\n?.#????#?????#??#?? 1,6,1,4,1\r\n#????????#?#?? 1,7,1,1\r\n?#??.?????? 3,1,1\r\n?..??#?###?? 1,6\r\n???.?.??#??##?? 1,1,1,5,1\r\n#???#.?????? 2,1,3,1\r\n?###??.??.?#???..? 4,1,2,1,1,1\r\n?.#???#?.?? 2,1,1\r\n#??##????##??????#? 7,5,2\r\n????#????????????# 1,6,1,1,2\r\n#?.?.##???? 1,1,5\r\n.?????.?#???????? 1,2,2,2,1\r\n#??.???#?.????? 2,5,1,1\r\n?????????.#???. 6,2\r\n?????????? 1,1,4\r\n?#??#??#?## 1,7\r\n????#?##???#? 1,6,1,1\r\n??#??#.???#?????? 1,1,1,7,1\r\n?????##?.?#??. 1,2,4\r\n???##????###????. 4,7\r\n?.?.?.?#???? 1,1,6\r\n???..??.????.###??. 2,2,2,5\r\n????##??#????? 1,7,1,1\r\n???..????#??? 2,6\r\n.??.????????. 1,2\r\n?.#?.????? 1,2\r\n??????.#???#? 2,5\r\n?????#.###???#.???# 6,7,1,1\r\n##.????##..#??#?. 2,6,1,1\r\n?????.??.?????????. 1,6\r\n??????..#?# 4,3\r\n#??????#??..?#? 10,2\r\n?.?????.?#??? 1,2\r\n???#??????.. 2,4\r\n.#?#???####??.?#?##? 12,5\r\n?.?????##??? 3,4\r\n?###?###????????# 10,3\r\n.?????????#? 1,5\r\n#?##????#???? 1,2,2,1\r\n.??????.??#???. 1,2,1,1,1\r\n??#.?#.????# 1,2,1,1\r\n???????.?#??????.?? 2,1,1,8,1\r\n???#??.?#???? 5,2,2\r\n?#??????###???. 2,8\r\n.??????#???????#? 1,12\r\n??..???#?#??? 1,6\r\n?.??????.. 1,1,3\r\n??#??.?#??#. 1,1,1,1\r\n?#?????.??????. 1,1,6\r\n.#?#?????#?#???#?.?? 5,9\r\n???#???#.#?##????? 5,1,7,1\r\n?#.??#??#?..?? 1,5,1\r\n#???#????#?.? 1,1,6,1\r\n????????.#? 4,1\r\n????#?#?#??.??.?? 8,1\r\n???#?????#?#?..#? 4,1,4,1\r\n??.??????#??.?#??#. 1,3,1,1\r\n.????????????? 1,2,2,1\r\n#.?#?#?#?.??? 1,6,1\r\n?#??#??..?#?? 3,2,3\r\n..#?.?#??#?# 2,6\r\n???#?.?..???## 3,1,2\r\n?????.?#?.???## 3,3,3\r\n??.?????..????? 3,5\r\n?.?????##? 1,1,2\r\n?.??#.#????#???.. 1,3,1,1,4\r\n??#??#?#?##????.# 3,3,6,1\r\n?.?.?.?####???.#. 1,8,1\r\n?##?????#?.?#.. 3,1,1,2,1\r\n???#???????.#. 2,4,1\r\n????.??.?#???? 1,3\r\n.?#?#?#??????##??? 2,11,2\r\n??.?#?.#?. 2,2,2\r\n????#...?#???# 4,5\r\n.??..???#??#?#? 2,1,1,3\r\n????#.?????? 3,6\r\n????.?????? 1,1,2\r\n????#?????.?# 1,2,2,2\r\n.?#?????.??.? 3,1,1,1\r\n???#??.?#.??. 1,3,2,2\r\n?##???????#???????# 2,9,1\r\n?##?????????.?? 8,1\r\n.#???????.??#???? 1,4,4\r\n.?#?.#??.? 1,1,1\r\n??.?#??????#? 4,3\r\n??#?#??#??.?? 3,2,1\r\n.#?.???##? 1,5\r\n?????.#?.???#? 2,1,1,4\r\n##????#??? 4,1,1\r\n?????????# 1,2,3\r\n??#?#?????##? 4,3\r\n?#.???##?#????#?##. 1,12\r\n#.?##???#???..??.?? 1,6,1,2,1\r\n?#????#??#.#?.##?# 5,1,1,1,4\r\n?#????#.#??#..? 1,3,1,1,1\r\n??###?.?.????. 5,2\r\n.????????#.#? 5,2,1\r\n.?.#.???..??#.?? 1,1,1,3,1\r\n#????????.??????. 4,4,2,1,1\r\n?.??????#? 3,3\r\n...?#.#.???##? 2,1,1,2\r\n??????????#.???.?#?? 7,1,1,1\r\n.????##?#??.???#???? 7,5\r\n??.#?.???? 1,2,2\r\n?.#??#??#?? 1,4,2\r\n????#?????? 1,4,2\r\n??.???????? 1,1,2\r\n??#????????#??#???? 3,3,7\r\n?????????##?.??#?. 1,1,2,1,3,2\r\n??#????????????.??? 2,11\r\n??#?.?#???#?##????. 4,3,4,1\r\n????.???????.?? 1,3\r\n????#.##?? 1,1,4\r\n#?????#?????.##?## 2,7,5\r\n#??.??..?#?#.? 2,1,4\r\n.??.??.?.?????##? 1,1,1,4\r\n??.???????#??? 1,7,1\r\n.#.??.?##???#.? 1,1,3,2,1\r\n#??.??##??.?#?.#?#?? 3,4,1,4\r\n???..?????????.# 2,1,3,1,1\r\n??#.?????#?##.?#.# 2,6,2,1,1\r\n?#?.?.#??#?? 1,6\r\n?###????#?.? 6,2\r\n?.?????????????.?? 1,1,1,1,4,1\r\n????.?#?##??#??. 1,1,5,2\r\n???????.????# 1,1,1,3\r\n##???.????#???# 2,1,1,1,5\r\n.#?##???####?.??#.?? 4,5,2\r\n????????#?#?.?#?? 1,1,3,1,3\r\n?.?????#?. 2,2\r\n?#???????????#.????? 7,2,1,1,1\r\n????????#..##. 1,2,2,2\r\n#?#?##?#??. 3,5\r\n???#????###????????. 17,1\r\n.????#???## 1,3,4\r\n??####??#??#?#?#?#?? 6,6,4\r\n??????#????.?.?? 1,3,1,1,1\r\n..?##?.?.?. 3,1\r\n.???####?????#? 8,1\r\n.???????#?..??.?# 1,3,1,2,1\r\n??.?#?????? 1,2,2\r\n??#???#..?#?????#??? 4,1,5,1,2\r\n??#?...#?? 4,1\r\n??????.#?#?##??.?? 2,7\r\n.???????##???. 1,9\r\n?..#.????#??#???#?? 1,3,9\r\n?#??????????#???.#?? 4,3,1,1,3\r\n.?????#???.??#?.?. 4,1\r\n??#.?##?#??##??#?#? 1,1,12,1\r\n?##??#??##???#.?.. 2,9\r\n#??????#??? 3,4\r\n##???.?#..#.?# 5,2,1,2\r\n???.?.???# 2,1,3\r\n?.?????.?? 2,2\r\n???.?????#?.?????? 1,2,2\r\n.#????#????.? 1,6\r\n????.#.?#??????#???? 1,1,1,1,2,7\r\n?.???.#.??##???#?? 1,1,1,1,8\r\n??????.?#? 4,2\r\n#??..?????#? 2,1,2,1\r\n?##.#.????##?# 2,1,2,4\r\n????????#???. 9,1\r\n??..????.? 1,4\r\n????#???#?.? 9,1\r\n#???.??????? 3,1,2,1\r\n.??????.?##??#. 6,3,1\r\n#.?.?#????#??#? 1,2,1,2,2\r\n##??##?.??? 6,1\r\n?????.????#???? 1,1,6\r\n#??.????????????#?#. 2,1,1,4,3\r\n???#??..?????#?## 5,3,2\r\n?##??????.??.? 4,4,1\r\n???#?????#?.? 2,1,3\r\n.?#?#????#?#?#? 5,6\r\n?..?#??###???? 1,7\r\n??#.???##.#? 2,4,1\r\n#??????#.?##?#?##??? 1,2,3,8,1\r\n?.?????????#?.? 2,6\r\n??.????##??? 1,3,2,2\r\n?#?#??#???#?#??? 10,4\r\n#.?.???#.#??#?? 1,1,1,1,6\r\n??##??.??? 3,1\r\n?????.??#..?.#? 1,1,3,1,2\r\n####???#????? 8,1,1\r\n?###???#?.. 4,1,1\r\n????.?????#?.???? 1,1,1,5,2\r\n#????#.??? 4,1,1\r\n??#??????.??#?. 7,1,1\r\n??#?????##??? 1,8\r\n..?#.?#???????. 2,2,2,1\r\n??.???#???.? 1,1,2,1\r\n.?.#?.?.??? 2,1,1\r\n????##??.????##?##?? 5,9\r\n?#???????..?? 2,3,2\r\n?#???????.??#????#?? 1,1,1,1,8\r\n#.?????#?.? 1,2,1\r\n#?.??????????????? 1,1,1,4,1,1\r\n??.#???#????#? 1,2,4,3\r\n.#???.???.#???#.? 4,1,1,2,1\r\n??????#???#?# 1,2,1,1\r\n????##??###??????.?? 1,8,4,1\r\n??#?????#?????????? 9,1,3\r\n.##???.???????? 2,1,1,1\r\n?#.???.??#????# 2,1,1,7\r\n.?..?..??? 1,1,2\r\n???.????.??#?? 3,2\r\n.?#.???#????????? 2,6\r\n????.?#?????????# 1,6,1,1,1\r\n???#?.?#???????? 1,2,4,2,1\r\n??##???#??#? 1,2,3,2\r\n#?.?.#.???? 1,1,3\r\n?#??#.?????? 1,2,4\r\n??????.##?????.? 1,4,1\r\n#????.???.#.???????. 1,1,3,1,3,1\r\n.#?##?..?##?.??.?? 4,2\r\n.#?###??#???#?? 9,3\r\n#??.##?.?.?#????#. 3,3,1,3,1,1\r\n?????##????? 3,2,1\r\n??#??????#????. 3,7\r\n????#.?#?? 1,1,1\r\n.??.#?##?.?? 1,5\r\n?#??.#..?????#??#??? 2,1,1,1,6,1\r\n?#?.??#???#??? 1,3,3\r\n????.?#.?????????? 4,1,1,1,1,1\r\n?.#.??????.?.##. 1,1,6,1,2\r\n????????#???#???? 1,5,3,1\r\n.?.?#??.?#?? 1,3,2\r\n??????????#??####?? 1,1,4,8\r\n?#???..????# 1,1,4\r\n.??###?.#..#???.?.? 5,1,1\r\n??.?.?????.???????.. 1,3,4\r\n..??????.???. 4,1\r\n#????????####??????# 1,11,2\r\n?#?.?.????? 1,1,2\r\n.?.?#??###?????.?#?? 1,2,7,1,1,1\r\n???#?.#???#????..? 1,3,2,6,1\r\n?..???????.? 1,1,4,1\r\n.??????.#?????????? 1,1,1,1,1,4\r\n?.?#??#?#???? 1,5\r\n???.????#????#### 1,1,11\r\n.??#.?????#??#??? 1,1,2,6,1\r\n?#.?????.#?? 2,1,2,3\r\n???.???#.#. 2,3,1\r\n?????.????.# 3,1,1\r\n.?????..?????# 4,1,2\r\n.??##??#?#?????#. 6,1,3\r\n??#?#???.??????#### 5,1,7\r\n???#??#??#??.? 1,1,6\r\n??????.???? 1,1,3\r\n???###?###?.#??#? 1,9,2,1\r\n##??.###..??? 4,3,1\r\n??.??.?????#? 1,1,4\r\n?#????????? 2,1,2\r\n#?.?????.#?.??#?. 1,2,2,1,2\r\n?#???..#????????#? 4,11\r\n?????????####?? 1,1,1,5\r\n??.?????.?#??????. 3,3,2\r\n????.?#?#????#??.?? 2,11\r\n##.#.?#.???.?.? 2,1,2,1,1\r\n??.??????.????? 2,2,1,1,3\r\n#?#???.#??#? 1,2,5\r\n??#?.????? 3,2,2\r\n??.???#??. 1,2\r\n????#??#?. 1,1,1\r\n#?.???.????? 1,1,1,5\r\n???????.#?#??#?#??? 2,1,1,1,1,4\r\n??#????##.? 5,2\r\n??#???#?..#???. 6,1,1\r\n?.#?????#?.. 1,3\r\n.??.??#????..???#? 2,5\r\n?#?#????#?????#? 3,6,1\r\n?###????.????##. 4,1,3\r\n?.???????# 1,2,1\r\n.??.??????#?..?## 1,6,2\r\n#???#??#????..???.?? 9,1,3\r\n#.???????????.???? 1,1,1,3,1,1\r\n..??##??????##????# 3,11\r\n?????.????????.?? 4,2,2,1\r\n#..??.?#?? 1,1,2\r\n????.???##???.#???? 1,1,1,6,1,2\r\n??#?#??#??.???????# 1,8,2,1,1\r\n??#.???#.?? 2,1\r\n???#?#?.#????????##? 3,2,8\r\n???#?.????#????? 4,6,2\r\n??.??..????? 1,2,1,1\r\n?.??#?#?????. 7,1\r\n?.????#??#??#?#? 2,7\r\n.?????????????#???? 3,1,4,1,1\r\n????.????.? 1,3\r\n??#..?????? 3,1,1\r\n.?#...??????. 2,1,3\r\n?????????????# 2,1,8\r\n?????????? 1,1,5\r\n??#?##??#?#?#?????? 6,2,1,1,1,1\r\n.???#?????#. 4,1,1\r\n?#.???#????###?#? 1,1,3,6\r\n????#?#?#???.?.#?? 1,4,1,1,1,1\r\n?#???###.??#?##? 2,1,3,6\r\n?????????.#? 6,1\r\n?????#???#????..# 4,1,4,2,1\r\n.?.????.?????????? 1,2,7\r\n#???????????? 1,1,2,5\r\n???????????#.??.? 5,4\r\n???##?#?#####???? 13,1\r\n??.?..???.?? 1,1\r\n???#?#?????? 8,1\r\n?.??#?.#??? 2,3\r\n#.?.??..#? 1,1,2\r\n????????.??#???? 2,1,1,1,4\r\n??#.??????????????? 1,3\r\n.??##?.??.???##??#?. 4,8\r\n?.???#????..???? 4,1\r\n?#??????#?#. 1,3,1,1\r\n#??####????.??? 11,2\r\n.?#??????????????? 2,3,6\r\n?#???#?#????#?.? 8,1,2\r\n??.????.?.??#?#? 2,1,1,1,5\r\n???#??.????#.. 4,2,2\r\n???.????????. 3,1,2,1\r\n#?#??.??#.????? 1,2,3,1,3\r\n????#.???#?. 1,1,1,5\r\n?????#???.?????. 8,2\r\n??##??##??##??##? 11,4\r\n??#.????#?? 2,5\r\n??????????? 2,3\r\n?????.#..? 1,1,1\r\n.???#????#?????? 10,1\r\n#???#?#???#????#???? 1,15,1\r\n??????????##? 1,1,1,5\r\n???.??##???.#..??#. 4,1,1\r\n.?????.??##.? 1,1,1,4\r\n??????##???..???#?? 3,5,1,2,1\r\n.?#?#????.?.#?. 6,1,1,1\r\n?????#?#?.#?? 1,4,1\r\n???.??##?.?????? 3,5,1,1,1\r\n?.????.????? 3,2,1\r\n..??.?..#??##????#? 2,10\r\n???..?????#?.??????? 1,2,5\r\n?#???????????#?.? 9,2\r\n..?##????##..# 2,1,2,1\r\n???#??????#?.# 9,1,1\r\n#?#???.??? 5,2\r\n???..???.?.??????. 1,2,3,1\r\n.#???.?.#??#?..?. 3,5\r\n?#?#??###?. 4,4\r\n????.?#???#? 2,3,2\r\n?#?.#?.?..#? 3,1,1,1\r\n???.??????.#??? 2,4,3\r\n.##??????##?#????.#? 10,2,2\r\n..??##??..??. 4,1\r\n#.##????....##.??? 1,2,3,2,3\r\n?.???#.?#.????? 2,2,4\r\n???#???.??###? 3,6\r\n?#..????..?##??.? 2,3,4\r\n??#.???????????. 1,1,4,2,1\r\n.##?????#???##?.???? 5,7,1\r\n??.?????#???#?#?? 2,1,1,9\r\n#?.??.?#.? 1,1,1\r\n???..??????#?? 1,2,4\r\n.#?#?#????.??#?.##?? 8,1,3\r\n??????????.?? 6,1\r\n?#????.?#.#??#?#.. 4,2,6\r\n.????????.??.?? 4,1\r\n???.#?#???????#... 6,1\r\n.????.????? 1,5\r\n?????????#. 1,5\r\n.?..??##?.##?. 3,3\r\n??.#?#?#?#????#???? 1,1,3,7,1\r\n..??#?#???#??. 5,3\r\n?..##????????? 1,5,1,1\r\n?#?????#?? 1,4\r\n#.???#??????#?. 1,4,5\r\n?????##????.?.?? 1,8,1\r\n???###?#??.??.?# 1,7,1,2\r\n?#.??#??#????? 1,5\r\n?#.???#????.???#?? 2,1,3,1,3\r\n??#?.???##.??.????.? 4,2,3,1\r\n??.??????#????#? 1,8\r\n?#???.?????#?? 3,2,2\r\n.#???????? 2,2\r\n??.##.????????????? 2,2,3,1\r\n#???????#?. 5,1\r\n##.??.#?.??#?? 2,1,2,2\r\n??????##??. 1,4\r\n??.??##????? 1,7,1\r\n???.?#??#??? 1,5\r\n?#???.?????##?#?#?.# 3,3,2,3,1\r\n?#?.????#? 2,1,1\r\n.?#?#??.??#???? 4,6\r\n?#..?######???? 1,10\r\n??##??????? 2,5\r\n???.????##..?..????? 2,2\r\n??...##.????? 2,2,1,1\r\n?#????#..#????#???? 6,10\r\n.?##?????#??# 2,7\r\n?????????#??#?#??#?? 2,10\r\n.??##????#??.???.#?? 11,1,1,1\r\n?#???.????# 2,5\r\n???#?.??..???##???.? 5,1,2,2,2\r\n???.??????????#? 1,1,1,4,2\r\n????###????.??? 8,2\r\n???.?#.??#??.??????. 1,3,2\r\n??#???.#????#?? 2,2,3\r\n#?#???#??#????.# 3,9,1\r\n.??#????????#.?? 1,1,1,4,1\r\n??#.????????#???#??? 1,3,1,3,1,1\r\n??.?#??##?#???#??## 1,15\r\n?????.?????#???#.??? 5,8,3\r\n.?##????..?#?. 6,2\r\n#????.??##????.# 1,1,6,1\r\n?##???#??.??#. 3,4,1,1\r\n???#.???#?.??????#.? 3,4,1,1,3\r\n????????.# 7,1\r\n?#???###?? 1,4,1\r\n??.??#????#? 1,1,7\r\n?#??????#..??.. 2,5,2\r\n.??.?#????#?#.. 1,9\r\n???..???#.??? 2,4\r\n#??##??#.??? 1,2,2,2\r\n..???.????? 2,1,2\r\n???????.????##.##.? 4,1,4,2\r\n??.??.?#.. 1,2,1\r\n??#??#????##? 1,1,6\r\n???##?###???# 1,8,1\r\n?#????????.?.#?? 3,1,1,3\r\n.?#?#??#?#.??.?? 9,1\r\n.?...???.????# 1,1,5\r\n...#?.#???#?#????? 1,8\r\n#...?????#??#?#???#? 1,1,1,1,8\r\n.??.??#?????????? 1,12\r\n#????.?###?##???. 5,7,1\r\n?#?.?#??????? 2,6\r\n?#?#??????? 6,1\r\n..???..?#??????.#? 3,3,2,1\r\n????.???#?? 1,2,2\r\n???##?##???#????? 5,3\r\n.???..#?#? 1,1,1\r\n?????#???#? 5,4\r\n#?.?##?#???#??#??.# 2,2,1,7,1\r\n?#?????.??#??#.?. 6,4\r\n???#.???.????.?? 3,2,2,1,2\r\n.??#?#??#??? 1,1,1,3\r\n?.??#.?.??? 3,2\r\n.?.#??????#????##?## 1,1,2,1,1,7\r\n.????#???#???? 2,6,3\r\n??##????????## 2,1,1,3\r\n.????..??. 3,1\r\n???#.?????###?.??#?? 2,1,1,3,4\r\n?..???..?.????????#? 1,2,1,7,2\r\n????????#?#? 1,5,3\r\n.????????????? 6,2\r\n???????##?#????.?#?? 1,5,2,1,1,1\r\n??#?#.????#?? 5,2,1,1\r\n??..#?????????. 1,4\r\n??#.#???#???#? 2,7,2\r\n.?.?.?????##?.?? 1,1,1,4,1\r\n.?#???.?#. 4,1\r\n??????#?.#??.?? 2,2,1,1,1\r\n.??#?.?#??? 3,2,1\r\n?##????##.??.??? 8,1,1\r\n???#..??.##??????#? 2,1,1,9\r\n.#???#??#? 2,5\r\n???#.???#???##???? 2,1,5,2,1\r\n?..#?????#????. 1,4\r\n.??????#??. 1,1,1\r\n?.??.?????#??#? 1,1,2,4\r\n???.?#.#??????.??? 3,1,2,2,1,2\r\n?????##?#??#????#.?? 1,13\r\n..#????????.?? 2,4\r\n?#??.?#?.?#??. 2,2,2\r\n???##.????##? 4,7\r\n?##?#?###?#.???.#??? 11,2,2\r\n?.???????#? 1,5\r\n??.?.???## 1,1,2\r\n..#??#?#??##???#???# 1,4,9,1\r\n?#??#????????## 3,1,1,5\r\n.#?.??#????????# 1,8,1\r\n#??????#???#?. 1,1,3,1\r\n.?.???.?#??## 1,6\r\n#?#?????#?#??#?..??? 1,1,3,1,3,1\r\n##??#???.?#?? 7,1\r\n..??#????.??##?#???. 5,8\r\n??..#??????? 1,1,1,2\r\n?????##?#.? 6,1,1\r\n???#???#?#?.# 4,1,1,1\r\n?.#???#.?#?#??.? 3,1,4\r\n?.?#??.???.#..? 2,1,1,1,1\r\n???#?#????.#????#? 1,2,5,1,1,1\r\n.#.??##??#?## 1,9\r\n???.????.???.? 4,3\r\n.???#???##.?#? 1,3,2,2\r\n...#??#?#?# 1,5\r\n???#?#???.. 1,3\r\n#?#???#??###. 1,5,4\r\n#?????????##?????## 1,1,1,1,6,3\r\n?.?#????#????###.? 8,3\r\n.??#???????????? 6,1,3\r\n.?...#.??#.#. 1,1,1,1\r\n.#????????? 4,2\r\n?????????##?.????? 8,3\r\n?????#?.?.???.??? 2,1,3,2\r\n.???#????#### 1,1,1,4\r\n.?.#??#??##?##???.?? 1,1,9,1,2\r\n?..#???#?#?.???.??. 1,8,1,1\r\n??.??.????????? 1,1,4,1,1\r\n.???#.#??.#.? 4,3,1\r\n???#???.??? 1,2,1\r\n?#???????..??#?#???? 5,7\r\n??#???????#?#????#? 1,6,5,3\r\n#???????????#.###? 1,2,1,1,2,4\r\n?#???#?.#??.?# 6,1,2\r\n#??????????.#?##?? 6,2,4\r\n???????.?#????? 2,1,1,2,4\r\n??#?##?#..?????#. 2,4,6\r\n??????.??#??#? 3,4\r\n.??...?????.? 1,2\r\n??#????##????????# 1,1,8,1,1\r\n.?#?????.? 1,1\r\n???#?#????.???? 4,1,1\r\n?.???.##?????# 1,8\r\n??.#??#.???? 1,4,3\r\n?.?#?????#. 1,5,1\r\n.???.?.????? 3,1,2,1\r\n???#?.#????..?#? 3,1,3,2\r\n??????#??#?### 1,9\r\n??????#??#???.#? 1,11,1\r\n?#????#?#?#?.? 3,2,4\r\n??#.????#??..?????.? 1,1,4,1,2,1\r\n?.???.???#??###?.? 1,1,2,7\r\n????..#?#???.?.#? 3,5,1,2\r\n???.?#####.##???? 1,1,5,2,2\r\n?#???##??#???? 1,1,8\r\n???.?##?????.?#?#??? 6,3\r\n????#..????.#?#.?#?? 4,4,1,1,1\r\n?#?.#???.????????? 3,1,1,7,1\r\n#??#??#?#..?????? 1,6,1,3\r\n???#???.?#? 1,3,1\r\n?#.?.?#???? 1,1,2\r\n.#???#?.?.????#.??? 1,1,2,1,3,1\r\n??.??####?.##???. 4,4\r\n?#?.??????? 1,3\r\n.???#?#?###????.## 11,1,2\r\n?#???###????? 2,3,1,1\r\n.#?#??##??#?.?????? 1,5,2,2,3\r\n.##?#??#??????#??? 8,3\r\n##?#?#????? 4,1,3\r\n??.????.??#?#?#?#??? 1,9\r\n????.#?.#??##.?#..#? 2,1,1,5,1,1\r\n??.#?#???###. 3,5\r\n#????#?#???.?? 3,6,2\r\n.#??..??#. 3,1,1\r\n???????.?#? 1,4,1\r\n#???????#???#. 1,3,1,5\r\n??###??#???? 7,1\r\n.??#?###??.?#?##?? 9,1,3\r\n#??#???#?????###??# 4,1,1,1,5,1\r\n?#.?#.??#????#. 1,1,3,1\r\n.##.????.??#?. 2,1,4\r\n##.??#?????????..## 2,8,1,2\r\n?.??#?.????. 2,3\r\n?#????##?#.???##?? 2,5,1,2\r\n#????#??#???#.# 1,10,1\r\n???????..? 1,1,1\r\n.??#??#??#?? 4,1,2,1\r\n?????#???..?? 2,1\r\n.#?..???###. 1,6\r\n???#?.??.???. 3,1,1\r\n?#????.#?.??.??.#. 2,2,2,2,1\r\n?.??#.??????? 2,4\r\n??#??????? 2,1,2\r\n???.?##?.??????? 2,2,1,1,1\r\n??.??#??#? 1,5\r\n#????????#?.##? 1,1,2,1,2\r\n#??.?.?#?????????? 1,1,1,4,1,1\r\n???.?#?.?#?? 3,1,1\r\n..??#??..?#?.??..?.? 1,3,1,1,1,1\r\n??#??#??##??#???.??? 6,5,3\r\n??????##????????#.# 2,7,2,1,1\r\n?#?.????.???#?? 2,2,4\r\n?#?#??????#????#?? 1,6,1,1,2\r\n???.?????? 1,2,1\r\n?????????###?#???? 1,9,5\r\n??????##?#????# 1,5,1,4\r\n?.?#?##?...#?? 5,1,1\r\n.???#...?????#?? 2,1,7\r\n???.??.?????.??? 3,1,2,1,1\r\n.?#??????. 1,3\r\n??????????#. 5,2\r\n????#???##????#??#? 2,2,3,8\r\n???#.????????##?# 1,1,1,5,1\r\n??????#?##?? 2,7\r\n?.?##???#??## 1,3,2,2\r\n?.????.?#.. 1,2\r\n?#.????.????. 2,3,3\r\n.?##????????????. 3,1,2\r\n.???.??#?.???#?# 2,2,1,3\r\n?#?.?#??????????? 2,2,1,1,5\r\n????#???#??????###?? 2,3,1,1,6,1\r\n?#?##???#??#??. 4,2,3\r\n??????.?#??.?? 1,1,3,1\r\n.?????#####??###? 9,3\r\n.?.???#?#.????.?## 1,4,3,2\r\n???###.??????? 5,1,2\r\n??#??.???. 4,1\r\n.?.?.?##.??#? 1,3,2\r\n???..?#??#?. 2,6\r\n??.#??#????????.?? 1,5\r\n??#.??##.?? 1,3\r\n?#.?.?#?.?#####????. 2,1,2,7\r\n???.????#?#??? 2,9\r\n??????#?.# 1,1,1\r\n???????????????????# 1,2,1,2,3,1\r\n?.??.?????#??#??#?. 1,2,4,8\r\n??#??????#?#??? 3,2,1,4\r\n.????????.???????? 4,1,1,2,1\r\n??????##?????????.?? 14,1\r\n.????.???????? 1,7\r\n??..?????##?.??#?? 2,7,4\r\n?..#?..???? 2,3\r\n.?.???.#???#?#????. 1,1,8\r\n?????.?.????????? 1,1,8\r\n??.??.??.#??? 1,2,1,4\r\n???.?###???? 2,3,1\r\n?#?????#???.????. 1,5,2\r\n.????#??.?????#?. 4,4\r\n???..?#?????.?. 2,3,3\r\n?##?.??.?#?????#? 4,1,4,3\r\n?????..#????##?? 1,1,1,6\r\n?.??##???..?#?.???? 5,3\r\n.????????#??????.?? 1,10,1\r\n.#?.?????#??# 1,7\r\n?##?##???.???#. 6,1,1,1\r\n?#??.#.?????#?#?. 1,1,1,1,6\r\n?#?###??.#??##?? 7,5,1\r\n.??#??????#?.?#????? 10,5\r\n?#.#??????????#???# 2,2,1,3,3,1\r\n???????????? 2,1,1,4\r\n.#?????##??#???# 1,5,1,3\r\n??..?.??????.?????. 2,3\r\n?#??.??????.#?#????? 2,3,3,1\r\n???#.????##???? 1,8\r\n???????#???#?#??. 1,1,8,1,1\r\n??????.??? 5,1\r\n?.?..??.#??#?#?? 1,1,1,7\r\n.#??##??#??? 6,1,1\r\n.?#.?...?? 2,1,1\r\n??#?##?#?????#???? 14,1\r\n..?#?.?#.????#?? 2,2,4\r\n.???.????.????#?? 2,1,1,1,3\r\n#.???????#??##???# 1,1,1,9,1\r\n??.???#?.. 2,5\r\n?#???#?.??????.???? 3,1,1,1,1,2\r\n.??#.???.#?#? 1,1,2,3\r\n.?#?.#???#. 2,1,1\r\n.?##?##?.?#..???.#?? 7,2,3,1,1\r\n?#????#??#??#.#.?. 1,9,1,1\r\n??.????????????? 2,1,1,2,4\r\n?.????????? 1,1,6\r\n????.#?????#??? 1,1,1,2,2\r\n.??#??.#??.??.?? 1,1,1,2,2\r\n#????????#??# 1,1,3,1\r\n???.?#??.##?? 3,3\r\n?##?#####???. 8,2\r\n????????????##???.?# 10,2,2,2\r\n??.?#.??????.? 1,1,1\r\n?????#.##???.?#??? 3,2,5,3\r\n???.?#????#?.? 1,8\r\n?.##?#???.#??.?.? 6,1,1\r\n???.??#?#???##.?.?? 2,4,4,1\r\n.#??##???#???? 6,4\r\n??....???. 1,3\r\n#??#??.?????? 5,1,2\r\n??????.?#.??..??? 1,1,2,1,2\r\n#??.????????.#?. 3,1,1,4,2\r\n#?.??.????? 1,1,4\r\n?##?.?#.?? 2,1\r\n?.?.##????.?. 1,1,6,1\r\n?????????? 1,1,1\r\n#???.?#?#????????..? 4,9,1,1\r\n????#???##??.? 6,2\r\n?##?????.#???# 3,2,5\r\n???#???#.? 2,1,1\r\n?.??????##.???.. 3,2\r\n?#?.?????? 1,1,2\r\n???.?#?##???#???? 1,6,1,1\r\n#?#.#.#..??.# 3,1,1,1\r\n.??????????? 5,4\r\n??#.?????##??? 3,2,2\r\n????#?#???##???.??? 14,3\r\n#.##????#?.#??.???? 1,7,1,2\r\n???#????#??????? 4,6,2\r\n?.##?#?.?????##? 2,1,7\r\n??.????#?#?????.? 1,1,4,3\r\n#.????.?#? 1,1,3\r\n.?#????##???.???? 1,7,2\r\n.#.?????#??##?# 1,11\r\n??????#??.#? 1,1,1,2\r\n??..#???.?? 2,1,1\r\n??###??#???????.???# 12,1,3\r\n.?#??#.#??????#??#?? 4,1,1,3,1,1\r\n??#??.????? 3,1,1\r\n.?..?????#????#?##?? 2,10\r\n?????????##??. 1,1,5\r\n?????#?#??#?????? 4,1,2,3\r\n#????.???? 1,3,3\r\n?.??#?????#?? 1,9\r\n?...#.??##???? 1,1,4\r\n?..?#.#????????.? 2,1,6,1\r\n#?#??#?.??????#??# 1,1,2,4,3,1\r\n????#?????.?.?? 1,5,1,1,1\r\n????.??#?.#?.?? 4,1,1,2,1\r\n?????????.?###? 7,4\r\n.#?#?#.?.?.????? 3,1,1,1,2\r\n???##.?.##? 2,2\r\n?#.?#.?#???##? 1,1,2,3\r\n?.????#???? 1,2,5\r\n?.?##.??#???.???? 1,3,5,1,1\r\n???..??##?? 2,4,1\r\n.????.????. 2,4\r\n????####..#???.??? 7,3,3\r\n???#???.##?.??#?#? 1,1,1,3,5\r\n??#??##?.? 1,3\r\n??#??????? 2,2\r\n#??..??????? 2,4\r\n?.??.?.???#??#?##?#? 1,1,1,10\r\n????.?#?.?#??#? 2,3,5\r\n?????????????#.?? 5,1,1,4,1\r\n?#?..?#.?.?? 2,2,2\r\n..#.?????? 1,4\r\n?.??##??????..??? 6,2\r\n??????#???? 3,1,1\r\n.?????????#???# 10,1,1\r\n????#?.#.?.???? 1,2,1,1,1\r\n?.#??.????#. 1,2,3,1\r\n??.#????.??#?????#?? 1,1,1,9\r\n???.????#..???. 1,1,5,1\r\n#???????#. 1,2,1\r\n??????#???#?##?#? 1,1,1,7\r\n??.?###???.?? 1,4,1,2\r\n.??#?#?..???#.??### 3,1,4,4\r\n.?###???.??#... 6,3\r\n?#?.??????#?###?#?? 2,7,7\r\n?#??????.??????.. 7,1,1,1\r\n.??????.??.???#?.# 1,1,1,2,2,1\r\n???.??.#???? 1,1,1,1\r\n???#???#??.?????? 1,1,4,2,1\r\n#?#.??#?#???#??? 3,1,1,1,3\r\n?#????????.#..????? 4,1,1,1,4\r\n??..???.?.? 1,3,1\r\n.????...??#????#.?. 2,1,1\r\n?????#??????#???? 6,7\r\n?.??#?#???? 1,5,2\r\n?..??#.???? 3,2\r\n???##???##??#? 1,2,5\r\n?.????????.#??#?.? 1,8,1,1,1\r\n#??#????###?.???.? 5,6,1,1\r\n????#?#?#?#???.??# 13,2\r\n???#?#??#?? 3,4\r\n??..?#???#????..? 1,4\r\n??#..?.????.???? 1,1,3,1,1\r\n?#??..??.???????.? 3,1,2,2,1\r\n?????#???? 2,3,1\r\n????#?#???.?#.#?#??? 1,6,1,1,6\r\n#?##?#?#??????. 4,1,1,4\r\n#?#.???#??? 3,2\r\n.??.??.???#?#.?.? 1,3\r\n???#?????#?? 1,3,1,1\r\n.???????#? 4,2\r\n???#?????.?????.. 1,4,1,1,2\r\n???????????#?# 2,1,5\r\n?.???.??..????.?.. 2,2\r\n???.?????#?.????? 1,1,1,4,3\r\n??.??????#???.?? 2,1,1,4,1\r\n??#??.#.?.?##?#??? 4,1,1,7\r\n?#???#?.???#??.#??#? 6,3,4\r\n??#?.?????????. 4,2,2,2\r\n??#????...##? 5,2\r\n?#???##.??.???#?#. 6,1,5\r\n????????#???#??.? 3,10\r\n???.?#??.???##? 2,2,4\r\n?..?????## 1,6\r\n#??#.#?##???#?? 1,2,1,3,3\r\n?##.????##?.?##. 3,3,3,3\r\n???.???..#??..?.?#? 2,1,1,1,1,2\r\n?#?##????#? 1,8\r\n.??#??#?##?## 1,1,8\r\n.#??..????..#.????? 1,1,1,1,1,5\r\n???????.?#??# 5,3,1\r\n#???#...?? 5,1\r\n.???###??????? 5,1\r\n?#?.?#?..#?#?#???? 1,2,1,1,2,1\r\n#??#???.?????.??? 6,3,1,1,1\r\n????#??.?. 1,2,1\r\n????.??#.?.???#??? 1,1,2,1,1,3\r\n#.???????##?????? 1,10,1,1\r\n?.??.???##???#.? 2,8\r\n?.#???.??#?? 3,2,1\r\n?#?.?#???. 2,4\r\n.???.#?..?#???##???? 1,2,2,7\r\n?#???????? 3,4\r\n?#???.?#?? 1,2,4\r\n?????#.??? 6,2\r\n??.???.?#? 1,2,2\r\n..#?????????#.?#?#?# 5,4,5\r\n#????#??#???? 2,1,4\r\n..??.???.???#??? 2,7\r\n??#??..??.???.?? 5,1,1,1\r\n.?#??#?#.?..#?#.? 7,3\r\n...?#?#?????#.?#? 2,7,2\r\n??..???.?????????.? 2,2,1,4\r\n???.?#???.? 1,3\r\n?#?#?.???##???# 3,5,2\r\n##?#.?##?.#? 4,3,2\r\n.?????##?# 1,5,1\r\n?.???#??#?#?? 1,7\r\n.????##??????.? 12,1\r\n???????.?.? 1,3\r\n?#.???##????..???#?. 2,6,1,4\r\n#???##?#..?????. 1,5,1,1\r\n#??##.???.????.? 1,3,1,1\r\n?.????#..??#??? 3,2\r\n.??????#??... 4,1\r\n.???#.?.??? 2,1\r\n?#??#??#?#????##?? 2,1,11\r\n.?#???..?.??.... 3,1,2\r\n???#??#??????#??? 1,2,2,3,4\r\n.###?????###.???? 11,4\r\n#?#?..#?#???#??????? 4,7,1,1\r\n????????????#?.. 6,3\r\n.#.??..????. 1,1,2,1\r\n?.#??#?#?#?#.?? 1,8,1\r\n.???#??##?????. 1,9\r\n#???????#? 2,1,3\r\n???#?#.?.?.???? 3,1,1,2\r\n.##???#??.??.#???# 8,5\r\n#?##??????????? 1,7,1\r\n??????????.??.?#? 7,1,1,3\r\n#????#????##?????? 13,1,1\r\n#??#????.?.?.?? 1,6,1,1\r\n?#??###???#? 1,8\r\n?????#..?? 2,3,1\r\n.??????.??????. 1,1,5\r\n???.?..???. 2,1\r\n???????#???##?#?? 3,2,5\r\n??????##??# 1,3,1\r\n#??..?#???. 3,5\r\n??#??#??#?#???#????? 15,1\r\n??.???.???###? 2,3\r\n?????????.???#. 2,5,3\r\n.???????..??#? 1,1,1,2\r\n????#?#.?.???.?? 6,1,1,1,1\r\n?.??????.?.## 1,4,1,2\r\n?#??#?#?.##??#?##??? 1,3,11\r\n????##???.. 1,2,1\r\n????.?.????#????#?#? 3,1,1,1,1,3\r\n???.?.????#??.? 1,6\r\n??##??????# 6,1,1\r\n??.?.????##?????. 2,1,2,2\r\n???...??????? 2,1\r\n.?????###???.????.. 9,1\r\n??.?#?.?.?##. 1,3\r\n??#???#.??.# 1,5,1\r\n??.????????? 1,5\r\n???#???.?.#??????.?# 6,1,1,3,1,2\r\n?????#.???##??.?. 1,1,1,7,1\r\n?.??#?#??#?..?#??. 1,4,2,2,1\r\n????????#????#??.?. 2,10\r\n????##???#???.???? 5,3,3\r\n#.#.?##??#?????#? 1,1,7,1,1\r\n#?????##??????? 1,1,6,1\r\n#.??#?.??..#.??#..?? 1,4,1,1,3,1\r\n#???#?#??#.?##? 1,5,1,2\r\n#.?##???#.?.??#. 1,6,1,1,1\r\n???.?.???? 1,1,1\r\n?#?#???.?? 4,1,1\r\n###?##?..???##?? 6,2\r\n?.#.?#??####???#?. 1,8,2\r\n#??.????#??? 1,1,3,2\r\n#?#??..#????#?? 1,1,1,1,3\r\n.???#?#???# 2,5,1\r\n?#?##???.???? 4,1,1\r\n?#?.???##??#??????? 2,8,1,1\r\n?????.???????.??##?? 2,1,6,3\r\n..????.#?#?? 2,4\r\n.?#???????#.??? 1,1,2,1,1\r\n??#?..#?#??..????? 2,4,4\r\n??.?.?..?? 2,1\r\n#??#???##??.??#? 5,5,2\r\n???#????.???? 5,1,1\r\n#???.??#?##?#.#..? 2,1,1,6,1,1\r\n.?#?##????????.? 1,3,2,1\r\n.#?#??.?.? 4,1\r\n??.???#?????????? 1,11\r\n.###????###????. 3,6,1\r\n??#????.?##? 4,3\r\n???.?###???# 1,8\r\n???.???.#???#?.? 1,1,5,1\r\n??##????????#?? 5,2,3\r\n#?#?#????#?##..#???? 1,1,9,1,2\r\n#??.##???.??? 1,2,1,1\r\n?..#?????. 1,3,1\r\n.???#?#??##????#??? 12,2\r\n#??????.??#? 7,3\r\n??#.?#?.#????#?.# 2,1,2,3,1\r\n?#?.?.???????? 2,7\r\n??.??#?#?.????????? 1,4,9\r\n.??.???##? 2,1,2\r\n.??????#.?.?????. 1,1,1,1\r\n???#.???#???#..? 1,1,8,1\r\n.????#???? 1,1,1\r\n?#.??.??????????#.? 1,1,2,5,1\r\n?.?.???.?. 1,1\r\n???.?.#???????#?#?#. 1,1,1,7,1,3\r\n??.?????#??## 1,1,1,2\r\n.????????? 3,2\r\n#?????????#????#. 6,4,2\r\n#??.?##???.??? 1,3,1,2\r\n??.???##?#? 4,2\r\n?#.?????.?.??#?.?. 1,2,1,1,4,1\r\n?????..??.?? 1,1,1,1\r\n#???#???#???? 2,1,5\r\n?.???..?????.?? 3,5\r\n??#..#?????????? 3,1,2,3\r\n#?????###???..?#? 1,1,4,1,1\r\n?##?#?.#?#? 5,4\r\n?##???#??..#??#? 9,1,1\r\n???#???##??????. 4,4\r\n??#???#??#.???#? 3,4,1,1,1\r\n?#?#??.?##?#??#?. 5,8\r\n?.???.?#???.????.. 1,1,5,3\r\n.???.?.?#??? 2,1,1,1\r\n###?.????.?????? 3,1,1,1,1\r\n????#??#???.?##???? 2,2,2,5\r\n???????#.?.?#? 1,4,1,1\r\n???????##?##?????#. 11,1,1\r\n.???#.?#?????### 1,2,1,1,5\r\n??????#????#..?? 8,1,1\r\n#?????#?..???.#? 8,2,1\r\n???#???##???? 1,3,2,2\r\n???????#????.??? 5,1,1,1\r\n?##..???#?? 3,5\r\n.??????#????.? 7,1\r\n?#?#?#???.??#??.?? 8,3\r\n?????##???#? 5,1\r\n??#?.??????#.?? 3,2,1,2,1\r\n.#?????.???..???..?. 5,2\r\n????#??????? 5,1\r\n?.?#??#?###?# 1,10\r\n????#?????.#??..? 5,3\r\n???#?#??.? 2,1,1\r\n.????.???#??? 3,1,3\r\n#?#?#????????. 1,1,1,6\r\n#.?##?#???##??#???? 1,5,2,1,1\r\n????.##??#???#??#? 1,9,2\r\n???#?#?#?#?.?# 8,2,1\r\n??#???#????#????#?.? 9,5,2\r\n#.????????#?. 1,1,1,2\r\n?????..????.???#?. 5,2,3\r\n????.??.?#.? 1,1,1,1\r\n???#??#?.??? 4,1\r\n???#???#?#??#?????? 1,1,4,2,1,1\r\n.?##??..?. 2,1\r\n?#####?????#??.??? 13,2\r\n???.#??#?#??#??. 1,1,7\r\n.???#?????#?#??.?#?# 12,3\r\n?...#...##. 1,2\r\n?.#????????.#?.?.?? 5,2,1,1,1\r\n?#???..#??? 3,1\r\n??.#?????????????#?? 1,1,6,1,1,1\r\n?.?..??#?..????? 1,1,4,1,3\r\n???.??.?#??.#.? 3,1,2,1,1\r\n?#?##??????#??? 1,2,3,3,1\r\n?#???.?.?#??.?#? 3,1,3,1\r\n##??.???.? 3,1\r\n.?.??????? 1,3\r\n?????#?#??.?????## 1,1,1,1,1,6\r\n..????.??..?? 1,2,1,1\r\n??#??.??#????? 4,4,1\r\n??.??.???#?? 1,3\r\n?????#?#???#? 1,1,3,1\r\n??.?..##???? 1,3\r\n.?.???.#?? 1,1,1\r\n?#????##??##???.#??# 4,2,6,1,1\r\n??.#?#?.???##...???? 1,4,4,3\r\n??.?#???.??? 4,1\r\n?#???#?.#???? 6,1,1";
            //InputData = "???.### 1,1,3\r\n.??..??...?##. 1,1,3\r\n?#?#?#?#?#?#?#? 1,3,1,6\r\n????.#...#... 4,1,1\r\n????.######..#####. 1,6,5\r\n?###???????? 3,2,1";   // Exemple donné pour debug
            #endregion

            InitInputData(InputData);

            foreach (string ligne in Lines)
            {
                InitialisationLigne(ligne);
            }
            if (this.Debug)
                DebugInit();
        }
        #endregion

        #region Initialisation
        /// <summary>
        /// Initialisation des données de travail pour une ligne.
        /// </summary>
        /// <param name="ligne">Données de la ligne d'entrée</param>
        private void InitialisationLigne(string ligne)
        {
            string s = ligne.ToString();
            while (s.Contains("..")) s = s.Replace("..", ".");
            
            SpringMap.Add(new SpringLine(s));
            SpringMapPt2.Add(new SpringLine(s, true));
        }
        #endregion

        #region Méthodes publiques
        public override long Partie1()
        {
            return ProcessPart1();
        }

        public override long Partie2()
        {
            return ProcessPart2();
        }
        #endregion

        #region Process
        private long ProcessPart1()
        {
            return SpringMap.CalculatePossibilities();
        }
        private long ProcessPart2()
        {
            return SpringMapPt2.CalculatePossibilities();
        }
        #endregion

        #region Debug
        private void DebugInit()
        {
        }
        #endregion

        #region Classes de travail
        private class Springs : List<SpringLine>
        {
            public long CalculatePossibilities()
            {
                return this.Sum(sm => sm.CalculatePossibilities());
            }
        }

        private class SpringLine
        {
            private string Line { get; set; }
            private List<int> Criteres { get; set; }
            private Dictionary<int, List<Possibilite>> Memo { get; set; } = new Dictionary<int, List<Possibilite>>();
            public SpringLine(string Line, bool Pt2 = false)
            {
                var Split = Line.Split(' ');
                this.Line = Split[0];
                Criteres = Split[1].Split(',').Select(int.Parse).ToList();

                if (Pt2)
                {
                    this.Line += "?" + Split[0] + "?" + Split[0] + "?" + Split[0] + "?" + Split[0];
                    List<int> Temp = Criteres.ToList();
                    Criteres.AddRange(Temp);
                    Criteres.AddRange(Temp);
                    Criteres.AddRange(Temp);
                    Criteres.AddRange(Temp);
                }

                Criteres.Select((c, i) => i).ToList().ForEach(i => Memo.Add(i, new List<Possibilite>()));
            }

            public long CalculatePossibilities()
            {
                var CriteresIndexes = Criteres.Select((c, i) => new { index = i, val = c }).ToList();

                // Pour chaque critère, on extrait la sous-chaine représentant les possibilités pour ce critère, et on calcule chacune de ces possibilités
                foreach (var crit in CriteresIndexes)
                {
                    int nbCharsAvant = CriteresIndexes.Sum(ci=> ci.index < crit.index ? ci.val + 1 : 0);
                    int nbCharsApres = CriteresIndexes.Sum(ci=> ci.index > crit.index ? ci.val + 1 : 0);
                    int longueurChaine = this.Line.Length - nbCharsAvant - nbCharsApres;
                    string Tmp = this.Line.Substring(nbCharsAvant, longueurChaine);
                    for(int i = 0; i <= Tmp.Length - crit.val; i++)
                    {
                        bool ajout = true;
                        if(Tmp.Substring(i, crit.val).Contains('.'))
                        {
                            ajout = false;
                        }
                        else
                        {
                            if (i > 0)
                            {
                                if (Tmp[i - 1] == '#')
                                {
                                    ajout = false;
                                }
                            }
                            if(i+crit.val < Tmp.Length)
                            {
                                if (Tmp[i + crit.val] == '#')
                                {
                                    ajout = false;
                                }
                            }
                        }
                        // Si la possibilité calculée est compatible avec les caractères précédents et suivants, on l'ajoute au mémo et on initialise la Regex de validation
                        if(ajout)
                        {
                            Possibilite p = new Possibilite()
                            {
                                IndexCritere = crit.index,
                                IndexDebut = nbCharsAvant + i,
                                IndexFin = nbCharsAvant + i + crit.val - 1,
                                isDernierCritere = crit.index == Criteres.Count - 1
                            };
                            p.SetRegex(Criteres.Take(crit.index + 1).ToList());
                            Memo[crit.index].Add(p);
                        }
                    }
                }

                // On initialise ensuite chaque possibilité et y ajoutant les possibilités compatibles pour le critère suivant
                foreach(var m in Memo.Where(m=>m.Key < Criteres.Count - 1))
                {
                    foreach(var pos in m.Value)
                    {
                        pos.PossibilitesIndexSup.AddRange(Memo[pos.IndexCritere + 1]);
                        pos.RemovePossibilitesIncompatibles();
                    }
                }

                // Pous on calcule le nombre de possibilités global
                long nb = Memo[0].Sum(p => p.CalculatePossibilities(this.Line, ""));

                return nb;
            }
        }

        private class Possibilite
        {
            public int IndexCritere { get; set; }
            public int IndexDebut { get; set; }
            public int IndexFin { get; set; }
            public long? NombreDePossibilites { get; set; } = null;
            public bool isDernierCritere { get; set; } = false;
            public Regex Validation { get; set; } = null;
            public List<Possibilite> PossibilitesIndexSup { get; private set; } = new List<Possibilite>();

            public void SetRegex(List<int> criteres)
            {
                Validation = new Regex("^\\.*#{" + string.Join("}\\.+#{", criteres) + "}\\.*$");
            }

            public void RemovePossibilitesIncompatibles()
            {
                PossibilitesIndexSup.RemoveAll(pis => pis.IndexDebut <= this.IndexFin + 1);
            }

            public long CalculatePossibilities(string Line, string s)
            {
                // On construit une chaîne temporaire correspondant à la chaîne construite avec les possibilités précédentes puis la possibilité actuelle, en comblant les "trous" par la chaîne originelle
                string sNew = s.ToString();
                if(IndexDebut > s.Length)
                {
                    sNew += Line.Substring(s.Length, IndexDebut - s.Length).Replace("?", ".");
                }
                sNew += "".PadRight(IndexFin - IndexDebut + 1, '#');
                if(isDernierCritere)
                {
                    if(sNew.Length < Line.Length)
                    {
                        sNew += Line.Substring(sNew.Length);
                    }
                }

                // Si la chaîne construite ne correspond pas au pattern attendu pour les n premiers critères, on ne va pas plus loin
                if(!Validation.IsMatch(sNew.Replace("?", ".")))
                {
                    return 0;
                }

                if(isDernierCritere)
                {
                    sNew = sNew.Replace("?", ".");
                    if(Validation.IsMatch(sNew.Replace("?", ".")))
                        return 1;
                    return 0;
                }
                else
                {
                    // Puis con continue avec le critèer suivant, en transmettant la chaîne temporaire
                    if(PossibilitesIndexSup.Count == 0)
                    {
                        NombreDePossibilites = 0;
                    }
                    if (!NombreDePossibilites.HasValue)
                        NombreDePossibilites =  PossibilitesIndexSup.Sum(pis => pis.CalculatePossibilities(Line, sNew));
                    return NombreDePossibilites.Value;
                }
            }
        }
        #endregion
    }
}
