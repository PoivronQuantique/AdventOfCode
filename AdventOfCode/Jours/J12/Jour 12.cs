
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Text.RegularExpressions;

namespace AdventOfCode.Jours
{
    public class Jour_12 : Jour_abs
    {
        #region Enumerables
        #endregion

        #region Propriétés
        private Springs SpringMap = new Springs();
        private Springs SpringMapPt2 = new Springs();
        #endregion

        #region Constructeur
        public Jour_12(bool debug = false):base(debug)
        {
            #region Input Data
            string InputData = ".#??..#??.?. 3,1,1,1\r\n???.##??#??????#???# 1,13,1\r\n.??#.?#??#????#?? 2,4,1,1,1\r\n???#??#.???#.?#??#?# 4,2,1,2,1,4\r\n????#?##???#.??.? 2,2,6,1\r\n.?????#???.###.##? 7,3,2\r\n.###?..#??????#???? 4,8,1\r\n??????????????? 1,1,1,2,1\r\n???.????????#? 1,3,1,1\r\n???.#..?#.?#?#??#?. 2,1,1,5,1\r\n.?..??#.????. 1,3,1,2\r\n.#?.??#?????##.# 1,2,1,3,1\r\n?###????.#?? 5,1,2\r\n?#??.????? 2,4\r\n?.#????#?????#??#?? 1,6,1,4,1\r\n#????????#?#?? 1,7,1,1\r\n?#??.?????? 3,1,1\r\n?..??#?###?? 1,6\r\n???.?.??#??##?? 1,1,1,5,1\r\n#???#.?????? 2,1,3,1\r\n?###??.??.?#???..? 4,1,2,1,1,1\r\n?.#???#?.?? 2,1,1\r\n#??##????##??????#? 7,5,2\r\n????#????????????# 1,6,1,1,2\r\n#?.?.##???? 1,1,5\r\n.?????.?#???????? 1,2,2,2,1\r\n#??.???#?.????? 2,5,1,1\r\n?????????.#???. 6,2\r\n?????????? 1,1,4\r\n?#??#??#?## 1,7\r\n????#?##???#? 1,6,1,1\r\n??#??#.???#?????? 1,1,1,7,1\r\n?????##?.?#??. 1,2,4\r\n???##????###????. 4,7\r\n?.?.?.?#???? 1,1,6\r\n???..??.????.###??. 2,2,2,5\r\n????##??#????? 1,7,1,1\r\n???..????#??? 2,6\r\n.??.????????. 1,2\r\n?.#?.????? 1,2\r\n??????.#???#? 2,5\r\n?????#.###???#.???# 6,7,1,1\r\n##.????##..#??#?. 2,6,1,1\r\n?????.??.?????????. 1,6\r\n??????..#?# 4,3\r\n#??????#??..?#? 10,2\r\n?.?????.?#??? 1,2\r\n???#??????.. 2,4\r\n.#?#???####??.?#?##? 12,5\r\n?.?????##??? 3,4\r\n?###?###????????# 10,3\r\n.?????????#? 1,5\r\n#?##????#???? 1,2,2,1\r\n.??????.??#???. 1,2,1,1,1\r\n??#.?#.????# 1,2,1,1\r\n???????.?#??????.?? 2,1,1,8,1\r\n???#??.?#???? 5,2,2\r\n?#??????###???. 2,8\r\n.??????#???????#? 1,12\r\n??..???#?#??? 1,6\r\n?.??????.. 1,1,3\r\n??#??.?#??#. 1,1,1,1\r\n?#?????.??????. 1,1,6\r\n.#?#?????#?#???#?.?? 5,9\r\n???#???#.#?##????? 5,1,7,1\r\n?#.??#??#?..?? 1,5,1\r\n#???#????#?.? 1,1,6,1\r\n????????.#? 4,1\r\n????#?#?#??.??.?? 8,1\r\n???#?????#?#?..#? 4,1,4,1\r\n??.??????#??.?#??#. 1,3,1,1\r\n.????????????? 1,2,2,1\r\n#.?#?#?#?.??? 1,6,1\r\n?#??#??..?#?? 3,2,3\r\n..#?.?#??#?# 2,6\r\n???#?.?..???## 3,1,2\r\n?????.?#?.???## 3,3,3\r\n??.?????..????? 3,5\r\n?.?????##? 1,1,2\r\n?.??#.#????#???.. 1,3,1,1,4\r\n??#??#?#?##????.# 3,3,6,1\r\n?.?.?.?####???.#. 1,8,1\r\n?##?????#?.?#.. 3,1,1,2,1\r\n???#???????.#. 2,4,1\r\n????.??.?#???? 1,3\r\n.?#?#?#??????##??? 2,11,2\r\n??.?#?.#?. 2,2,2\r\n????#...?#???# 4,5\r\n.??..???#??#?#? 2,1,1,3\r\n????#.?????? 3,6\r\n????.?????? 1,1,2\r\n????#?????.?# 1,2,2,2\r\n.?#?????.??.? 3,1,1,1\r\n???#??.?#.??. 1,3,2,2\r\n?##???????#???????# 2,9,1\r\n?##?????????.?? 8,1\r\n.#???????.??#???? 1,4,4\r\n.?#?.#??.? 1,1,1\r\n??.?#??????#? 4,3\r\n??#?#??#??.?? 3,2,1\r\n.#?.???##? 1,5\r\n?????.#?.???#? 2,1,1,4\r\n##????#??? 4,1,1\r\n?????????# 1,2,3\r\n??#?#?????##? 4,3\r\n?#.???##?#????#?##. 1,12\r\n#.?##???#???..??.?? 1,6,1,2,1\r\n?#????#??#.#?.##?# 5,1,1,1,4\r\n?#????#.#??#..? 1,3,1,1,1\r\n??###?.?.????. 5,2\r\n.????????#.#? 5,2,1\r\n.?.#.???..??#.?? 1,1,1,3,1\r\n#????????.??????. 4,4,2,1,1\r\n?.??????#? 3,3\r\n...?#.#.???##? 2,1,1,2\r\n??????????#.???.?#?? 7,1,1,1\r\n.????##?#??.???#???? 7,5\r\n??.#?.???? 1,2,2\r\n?.#??#??#?? 1,4,2\r\n????#?????? 1,4,2\r\n??.???????? 1,1,2\r\n??#????????#??#???? 3,3,7\r\n?????????##?.??#?. 1,1,2,1,3,2\r\n??#????????????.??? 2,11\r\n??#?.?#???#?##????. 4,3,4,1\r\n????.???????.?? 1,3\r\n????#.##?? 1,1,4\r\n#?????#?????.##?## 2,7,5\r\n#??.??..?#?#.? 2,1,4\r\n.??.??.?.?????##? 1,1,1,4\r\n??.???????#??? 1,7,1\r\n.#.??.?##???#.? 1,1,3,2,1\r\n#??.??##??.?#?.#?#?? 3,4,1,4\r\n???..?????????.# 2,1,3,1,1\r\n??#.?????#?##.?#.# 2,6,2,1,1\r\n?#?.?.#??#?? 1,6\r\n?###????#?.? 6,2\r\n?.?????????????.?? 1,1,1,1,4,1\r\n????.?#?##??#??. 1,1,5,2\r\n???????.????# 1,1,1,3\r\n##???.????#???# 2,1,1,1,5\r\n.#?##???####?.??#.?? 4,5,2\r\n????????#?#?.?#?? 1,1,3,1,3\r\n?.?????#?. 2,2\r\n?#???????????#.????? 7,2,1,1,1\r\n????????#..##. 1,2,2,2\r\n#?#?##?#??. 3,5\r\n???#????###????????. 17,1\r\n.????#???## 1,3,4\r\n??####??#??#?#?#?#?? 6,6,4\r\n??????#????.?.?? 1,3,1,1,1\r\n..?##?.?.?. 3,1\r\n.???####?????#? 8,1\r\n.???????#?..??.?# 1,3,1,2,1\r\n??.?#?????? 1,2,2\r\n??#???#..?#?????#??? 4,1,5,1,2\r\n??#?...#?? 4,1\r\n??????.#?#?##??.?? 2,7\r\n.???????##???. 1,9\r\n?..#.????#??#???#?? 1,3,9\r\n?#??????????#???.#?? 4,3,1,1,3\r\n.?????#???.??#?.?. 4,1\r\n??#.?##?#??##??#?#? 1,1,12,1\r\n?##??#??##???#.?.. 2,9\r\n#??????#??? 3,4\r\n##???.?#..#.?# 5,2,1,2\r\n???.?.???# 2,1,3\r\n?.?????.?? 2,2\r\n???.?????#?.?????? 1,2,2\r\n.#????#????.? 1,6\r\n????.#.?#??????#???? 1,1,1,1,2,7\r\n?.???.#.??##???#?? 1,1,1,1,8\r\n??????.?#? 4,2\r\n#??..?????#? 2,1,2,1\r\n?##.#.????##?# 2,1,2,4\r\n????????#???. 9,1\r\n??..????.? 1,4\r\n????#???#?.? 9,1\r\n#???.??????? 3,1,2,1\r\n.??????.?##??#. 6,3,1\r\n#.?.?#????#??#? 1,2,1,2,2\r\n##??##?.??? 6,1\r\n?????.????#???? 1,1,6\r\n#??.????????????#?#. 2,1,1,4,3\r\n???#??..?????#?## 5,3,2\r\n?##??????.??.? 4,4,1\r\n???#?????#?.? 2,1,3\r\n.?#?#????#?#?#? 5,6\r\n?..?#??###???? 1,7\r\n??#.???##.#? 2,4,1\r\n#??????#.?##?#?##??? 1,2,3,8,1\r\n?.?????????#?.? 2,6\r\n??.????##??? 1,3,2,2\r\n?#?#??#???#?#??? 10,4\r\n#.?.???#.#??#?? 1,1,1,1,6\r\n??##??.??? 3,1\r\n?????.??#..?.#? 1,1,3,1,2\r\n####???#????? 8,1,1\r\n?###???#?.. 4,1,1\r\n????.?????#?.???? 1,1,1,5,2\r\n#????#.??? 4,1,1\r\n??#??????.??#?. 7,1,1\r\n??#?????##??? 1,8\r\n..?#.?#???????. 2,2,2,1\r\n??.???#???.? 1,1,2,1\r\n.?.#?.?.??? 2,1,1\r\n????##??.????##?##?? 5,9\r\n?#???????..?? 2,3,2\r\n?#???????.??#????#?? 1,1,1,1,8\r\n#.?????#?.? 1,2,1\r\n#?.??????????????? 1,1,1,4,1,1\r\n??.#???#????#? 1,2,4,3\r\n.#???.???.#???#.? 4,1,1,2,1\r\n??????#???#?# 1,2,1,1\r\n????##??###??????.?? 1,8,4,1\r\n??#?????#?????????? 9,1,3\r\n.##???.???????? 2,1,1,1\r\n?#.???.??#????# 2,1,1,7\r\n.?..?..??? 1,1,2\r\n???.????.??#?? 3,2\r\n.?#.???#????????? 2,6\r\n????.?#?????????# 1,6,1,1,1\r\n???#?.?#???????? 1,2,4,2,1\r\n??##???#??#? 1,2,3,2\r\n#?.?.#.???? 1,1,3\r\n?#??#.?????? 1,2,4\r\n??????.##?????.? 1,4,1\r\n#????.???.#.???????. 1,1,3,1,3,1\r\n.#?##?..?##?.??.?? 4,2\r\n.#?###??#???#?? 9,3\r\n#??.##?.?.?#????#. 3,3,1,3,1,1\r\n?????##????? 3,2,1\r\n??#??????#????. 3,7\r\n????#.?#?? 1,1,1\r\n.??.#?##?.?? 1,5\r\n?#??.#..?????#??#??? 2,1,1,1,6,1\r\n?#?.??#???#??? 1,3,3\r\n????.?#.?????????? 4,1,1,1,1,1\r\n?.#.??????.?.##. 1,1,6,1,2\r\n????????#???#???? 1,5,3,1\r\n.?.?#??.?#?? 1,3,2\r\n??????????#??####?? 1,1,4,8\r\n?#???..????# 1,1,4\r\n.??###?.#..#???.?.? 5,1,1\r\n??.?.?????.???????.. 1,3,4\r\n..??????.???. 4,1\r\n#????????####??????# 1,11,2\r\n?#?.?.????? 1,1,2\r\n.?.?#??###?????.?#?? 1,2,7,1,1,1\r\n???#?.#???#????..? 1,3,2,6,1\r\n?..???????.? 1,1,4,1\r\n.??????.#?????????? 1,1,1,1,1,4\r\n?.?#??#?#???? 1,5\r\n???.????#????#### 1,1,11\r\n.??#.?????#??#??? 1,1,2,6,1\r\n?#.?????.#?? 2,1,2,3\r\n???.???#.#. 2,3,1\r\n?????.????.# 3,1,1\r\n.?????..?????# 4,1,2\r\n.??##??#?#?????#. 6,1,3\r\n??#?#???.??????#### 5,1,7\r\n???#??#??#??.? 1,1,6\r\n??????.???? 1,1,3\r\n???###?###?.#??#? 1,9,2,1\r\n##??.###..??? 4,3,1\r\n??.??.?????#? 1,1,4\r\n?#????????? 2,1,2\r\n#?.?????.#?.??#?. 1,2,2,1,2\r\n?#???..#????????#? 4,11\r\n?????????####?? 1,1,1,5\r\n??.?????.?#??????. 3,3,2\r\n????.?#?#????#??.?? 2,11\r\n##.#.?#.???.?.? 2,1,2,1,1\r\n??.??????.????? 2,2,1,1,3\r\n#?#???.#??#? 1,2,5\r\n??#?.????? 3,2,2\r\n??.???#??. 1,2\r\n????#??#?. 1,1,1\r\n#?.???.????? 1,1,1,5\r\n???????.#?#??#?#??? 2,1,1,1,1,4\r\n??#????##.? 5,2\r\n??#???#?..#???. 6,1,1\r\n?.#?????#?.. 1,3\r\n.??.??#????..???#? 2,5\r\n?#?#????#?????#? 3,6,1\r\n?###????.????##. 4,1,3\r\n?.???????# 1,2,1\r\n.??.??????#?..?## 1,6,2\r\n#???#??#????..???.?? 9,1,3\r\n#.???????????.???? 1,1,1,3,1,1\r\n..??##??????##????# 3,11\r\n?????.????????.?? 4,2,2,1\r\n#..??.?#?? 1,1,2\r\n????.???##???.#???? 1,1,1,6,1,2\r\n??#?#??#??.???????# 1,8,2,1,1\r\n??#.???#.?? 2,1\r\n???#?#?.#????????##? 3,2,8\r\n???#?.????#????? 4,6,2\r\n??.??..????? 1,2,1,1\r\n?.??#?#?????. 7,1\r\n?.????#??#??#?#? 2,7\r\n.?????????????#???? 3,1,4,1,1\r\n????.????.? 1,3\r\n??#..?????? 3,1,1\r\n.?#...??????. 2,1,3\r\n?????????????# 2,1,8\r\n?????????? 1,1,5\r\n??#?##??#?#?#?????? 6,2,1,1,1,1\r\n.???#?????#. 4,1,1\r\n?#.???#????###?#? 1,1,3,6\r\n????#?#?#???.?.#?? 1,4,1,1,1,1\r\n?#???###.??#?##? 2,1,3,6\r\n?????????.#? 6,1\r\n?????#???#????..# 4,1,4,2,1\r\n.?.????.?????????? 1,2,7\r\n#???????????? 1,1,2,5\r\n???????????#.??.? 5,4\r\n???##?#?#####???? 13,1\r\n??.?..???.?? 1,1\r\n???#?#?????? 8,1\r\n?.??#?.#??? 2,3\r\n#.?.??..#? 1,1,2\r\n????????.??#???? 2,1,1,1,4\r\n??#.??????????????? 1,3\r\n.??##?.??.???##??#?. 4,8\r\n?.???#????..???? 4,1\r\n?#??????#?#. 1,3,1,1\r\n#??####????.??? 11,2\r\n.?#??????????????? 2,3,6\r\n?#???#?#????#?.? 8,1,2\r\n??.????.?.??#?#? 2,1,1,1,5\r\n???#??.????#.. 4,2,2\r\n???.????????. 3,1,2,1\r\n#?#??.??#.????? 1,2,3,1,3\r\n????#.???#?. 1,1,1,5\r\n?????#???.?????. 8,2\r\n??##??##??##??##? 11,4\r\n??#.????#?? 2,5\r\n??????????? 2,3\r\n?????.#..? 1,1,1\r\n.???#????#?????? 10,1\r\n#???#?#???#????#???? 1,15,1\r\n??????????##? 1,1,1,5\r\n???.??##???.#..??#. 4,1,1\r\n.?????.??##.? 1,1,1,4\r\n??????##???..???#?? 3,5,1,2,1\r\n.?#?#????.?.#?. 6,1,1,1\r\n?????#?#?.#?? 1,4,1\r\n???.??##?.?????? 3,5,1,1,1\r\n?.????.????? 3,2,1\r\n..??.?..#??##????#? 2,10\r\n???..?????#?.??????? 1,2,5\r\n?#???????????#?.? 9,2\r\n..?##????##..# 2,1,2,1\r\n???#??????#?.# 9,1,1\r\n#?#???.??? 5,2\r\n???..???.?.??????. 1,2,3,1\r\n.#???.?.#??#?..?. 3,5\r\n?#?#??###?. 4,4\r\n????.?#???#? 2,3,2\r\n?#?.#?.?..#? 3,1,1,1\r\n???.??????.#??? 2,4,3\r\n.##??????##?#????.#? 10,2,2\r\n..??##??..??. 4,1\r\n#.##????....##.??? 1,2,3,2,3\r\n?.???#.?#.????? 2,2,4\r\n???#???.??###? 3,6\r\n?#..????..?##??.? 2,3,4\r\n??#.???????????. 1,1,4,2,1\r\n.##?????#???##?.???? 5,7,1\r\n??.?????#???#?#?? 2,1,1,9\r\n#?.??.?#.? 1,1,1\r\n???..??????#?? 1,2,4\r\n.#?#?#????.??#?.##?? 8,1,3\r\n??????????.?? 6,1\r\n?#????.?#.#??#?#.. 4,2,6\r\n.????????.??.?? 4,1\r\n???.#?#???????#... 6,1\r\n.????.????? 1,5\r\n?????????#. 1,5\r\n.?..??##?.##?. 3,3\r\n??.#?#?#?#????#???? 1,1,3,7,1\r\n..??#?#???#??. 5,3\r\n?..##????????? 1,5,1,1\r\n?#?????#?? 1,4\r\n#.???#??????#?. 1,4,5\r\n?????##????.?.?? 1,8,1\r\n???###?#??.??.?# 1,7,1,2\r\n?#.??#??#????? 1,5\r\n?#.???#????.???#?? 2,1,3,1,3\r\n??#?.???##.??.????.? 4,2,3,1\r\n??.??????#????#? 1,8\r\n?#???.?????#?? 3,2,2\r\n.#???????? 2,2\r\n??.##.????????????? 2,2,3,1\r\n#???????#?. 5,1\r\n##.??.#?.??#?? 2,1,2,2\r\n??????##??. 1,4\r\n??.??##????? 1,7,1\r\n???.?#??#??? 1,5\r\n?#???.?????##?#?#?.# 3,3,2,3,1\r\n?#?.????#? 2,1,1\r\n.?#?#??.??#???? 4,6\r\n?#..?######???? 1,10\r\n??##??????? 2,5\r\n???.????##..?..????? 2,2\r\n??...##.????? 2,2,1,1\r\n?#????#..#????#???? 6,10\r\n.?##?????#??# 2,7\r\n?????????#??#?#??#?? 2,10\r\n.??##????#??.???.#?? 11,1,1,1\r\n?#???.????# 2,5\r\n???#?.??..???##???.? 5,1,2,2,2\r\n???.??????????#? 1,1,1,4,2\r\n????###????.??? 8,2\r\n???.?#.??#??.??????. 1,3,2\r\n??#???.#????#?? 2,2,3\r\n#?#???#??#????.# 3,9,1\r\n.??#????????#.?? 1,1,1,4,1\r\n??#.????????#???#??? 1,3,1,3,1,1\r\n??.?#??##?#???#??## 1,15\r\n?????.?????#???#.??? 5,8,3\r\n.?##????..?#?. 6,2\r\n#????.??##????.# 1,1,6,1\r\n?##???#??.??#. 3,4,1,1\r\n???#.???#?.??????#.? 3,4,1,1,3\r\n????????.# 7,1\r\n?#???###?? 1,4,1\r\n??.??#????#? 1,1,7\r\n?#??????#..??.. 2,5,2\r\n.??.?#????#?#.. 1,9\r\n???..???#.??? 2,4\r\n#??##??#.??? 1,2,2,2\r\n..???.????? 2,1,2\r\n???????.????##.##.? 4,1,4,2\r\n??.??.?#.. 1,2,1\r\n??#??#????##? 1,1,6\r\n???##?###???# 1,8,1\r\n?#????????.?.#?? 3,1,1,3\r\n.?#?#??#?#.??.?? 9,1\r\n.?...???.????# 1,1,5\r\n...#?.#???#?#????? 1,8\r\n#...?????#??#?#???#? 1,1,1,1,8\r\n.??.??#?????????? 1,12\r\n#????.?###?##???. 5,7,1\r\n?#?.?#??????? 2,6\r\n?#?#??????? 6,1\r\n..???..?#??????.#? 3,3,2,1\r\n????.???#?? 1,2,2\r\n???##?##???#????? 5,3\r\n.???..#?#? 1,1,1\r\n?????#???#? 5,4\r\n#?.?##?#???#??#??.# 2,2,1,7,1\r\n?#?????.??#??#.?. 6,4\r\n???#.???.????.?? 3,2,2,1,2\r\n.??#?#??#??? 1,1,1,3\r\n?.??#.?.??? 3,2\r\n.?.#??????#????##?## 1,1,2,1,1,7\r\n.????#???#???? 2,6,3\r\n??##????????## 2,1,1,3\r\n.????..??. 3,1\r\n???#.?????###?.??#?? 2,1,1,3,4\r\n?..???..?.????????#? 1,2,1,7,2\r\n????????#?#? 1,5,3\r\n.????????????? 6,2\r\n???????##?#????.?#?? 1,5,2,1,1,1\r\n??#?#.????#?? 5,2,1,1\r\n??..#?????????. 1,4\r\n??#.#???#???#? 2,7,2\r\n.?.?.?????##?.?? 1,1,1,4,1\r\n.?#???.?#. 4,1\r\n??????#?.#??.?? 2,2,1,1,1\r\n.??#?.?#??? 3,2,1\r\n?##????##.??.??? 8,1,1\r\n???#..??.##??????#? 2,1,1,9\r\n.#???#??#? 2,5\r\n???#.???#???##???? 2,1,5,2,1\r\n?..#?????#????. 1,4\r\n.??????#??. 1,1,1\r\n?.??.?????#??#? 1,1,2,4\r\n???.?#.#??????.??? 3,1,2,2,1,2\r\n?????##?#??#????#.?? 1,13\r\n..#????????.?? 2,4\r\n?#??.?#?.?#??. 2,2,2\r\n???##.????##? 4,7\r\n?##?#?###?#.???.#??? 11,2,2\r\n?.???????#? 1,5\r\n??.?.???## 1,1,2\r\n..#??#?#??##???#???# 1,4,9,1\r\n?#??#????????## 3,1,1,5\r\n.#?.??#????????# 1,8,1\r\n#??????#???#?. 1,1,3,1\r\n.?.???.?#??## 1,6\r\n#?#?????#?#??#?..??? 1,1,3,1,3,1\r\n##??#???.?#?? 7,1\r\n..??#????.??##?#???. 5,8\r\n??..#??????? 1,1,1,2\r\n?????##?#.? 6,1,1\r\n???#???#?#?.# 4,1,1,1\r\n?.#???#.?#?#??.? 3,1,4\r\n?.?#??.???.#..? 2,1,1,1,1\r\n???#?#????.#????#? 1,2,5,1,1,1\r\n.#.??##??#?## 1,9\r\n???.????.???.? 4,3\r\n.???#???##.?#? 1,3,2,2\r\n...#??#?#?# 1,5\r\n???#?#???.. 1,3\r\n#?#???#??###. 1,5,4\r\n#?????????##?????## 1,1,1,1,6,3\r\n?.?#????#????###.? 8,3\r\n.??#???????????? 6,1,3\r\n.?...#.??#.#. 1,1,1,1\r\n.#????????? 4,2\r\n?????????##?.????? 8,3\r\n?????#?.?.???.??? 2,1,3,2\r\n.???#????#### 1,1,1,4\r\n.?.#??#??##?##???.?? 1,1,9,1,2\r\n?..#???#?#?.???.??. 1,8,1,1\r\n??.??.????????? 1,1,4,1,1\r\n.???#.#??.#.? 4,3,1\r\n???#???.??? 1,2,1\r\n?#???????..??#?#???? 5,7\r\n??#???????#?#????#? 1,6,5,3\r\n#???????????#.###? 1,2,1,1,2,4\r\n?#???#?.#??.?# 6,1,2\r\n#??????????.#?##?? 6,2,4\r\n???????.?#????? 2,1,1,2,4\r\n??#?##?#..?????#. 2,4,6\r\n??????.??#??#? 3,4\r\n.??...?????.? 1,2\r\n??#????##????????# 1,1,8,1,1\r\n.?#?????.? 1,1\r\n???#?#????.???? 4,1,1\r\n?.???.##?????# 1,8\r\n??.#??#.???? 1,4,3\r\n?.?#?????#. 1,5,1\r\n.???.?.????? 3,1,2,1\r\n???#?.#????..?#? 3,1,3,2\r\n??????#??#?### 1,9\r\n??????#??#???.#? 1,11,1\r\n?#????#?#?#?.? 3,2,4\r\n??#.????#??..?????.? 1,1,4,1,2,1\r\n?.???.???#??###?.? 1,1,2,7\r\n????..#?#???.?.#? 3,5,1,2\r\n???.?#####.##???? 1,1,5,2,2\r\n?#???##??#???? 1,1,8\r\n???.?##?????.?#?#??? 6,3\r\n????#..????.#?#.?#?? 4,4,1,1,1\r\n?#?.#???.????????? 3,1,1,7,1\r\n#??#??#?#..?????? 1,6,1,3\r\n???#???.?#? 1,3,1\r\n?#.?.?#???? 1,1,2\r\n.#???#?.?.????#.??? 1,1,2,1,3,1\r\n??.??####?.##???. 4,4\r\n?#?.??????? 1,3\r\n.???#?#?###????.## 11,1,2\r\n?#???###????? 2,3,1,1\r\n.#?#??##??#?.?????? 1,5,2,2,3\r\n.##?#??#??????#??? 8,3\r\n##?#?#????? 4,1,3\r\n??.????.??#?#?#?#??? 1,9\r\n????.#?.#??##.?#..#? 2,1,1,5,1,1\r\n??.#?#???###. 3,5\r\n#????#?#???.?? 3,6,2\r\n.#??..??#. 3,1,1\r\n???????.?#? 1,4,1\r\n#???????#???#. 1,3,1,5\r\n??###??#???? 7,1\r\n.??#?###??.?#?##?? 9,1,3\r\n#??#???#?????###??# 4,1,1,1,5,1\r\n?#.?#.??#????#. 1,1,3,1\r\n.##.????.??#?. 2,1,4\r\n##.??#?????????..## 2,8,1,2\r\n?.??#?.????. 2,3\r\n?#????##?#.???##?? 2,5,1,2\r\n#????#??#???#.# 1,10,1\r\n???????..? 1,1,1\r\n.??#??#??#?? 4,1,2,1\r\n?????#???..?? 2,1\r\n.#?..???###. 1,6\r\n???#?.??.???. 3,1,1\r\n?#????.#?.??.??.#. 2,2,2,2,1\r\n?.??#.??????? 2,4\r\n??#??????? 2,1,2\r\n???.?##?.??????? 2,2,1,1,1\r\n??.??#??#? 1,5\r\n#????????#?.##? 1,1,2,1,2\r\n#??.?.?#?????????? 1,1,1,4,1,1\r\n???.?#?.?#?? 3,1,1\r\n..??#??..?#?.??..?.? 1,3,1,1,1,1\r\n??#??#??##??#???.??? 6,5,3\r\n??????##????????#.# 2,7,2,1,1\r\n?#?.????.???#?? 2,2,4\r\n?#?#??????#????#?? 1,6,1,1,2\r\n???.?????? 1,2,1\r\n?????????###?#???? 1,9,5\r\n??????##?#????# 1,5,1,4\r\n?.?#?##?...#?? 5,1,1\r\n.???#...?????#?? 2,1,7\r\n???.??.?????.??? 3,1,2,1,1\r\n.?#??????. 1,3\r\n??????????#. 5,2\r\n????#???##????#??#? 2,2,3,8\r\n???#.????????##?# 1,1,1,5,1\r\n??????#?##?? 2,7\r\n?.?##???#??## 1,3,2,2\r\n?.????.?#.. 1,2\r\n?#.????.????. 2,3,3\r\n.?##????????????. 3,1,2\r\n.???.??#?.???#?# 2,2,1,3\r\n?#?.?#??????????? 2,2,1,1,5\r\n????#???#??????###?? 2,3,1,1,6,1\r\n?#?##???#??#??. 4,2,3\r\n??????.?#??.?? 1,1,3,1\r\n.?????#####??###? 9,3\r\n.?.???#?#.????.?## 1,4,3,2\r\n???###.??????? 5,1,2\r\n??#??.???. 4,1\r\n.?.?.?##.??#? 1,3,2\r\n???..?#??#?. 2,6\r\n??.#??#????????.?? 1,5\r\n??#.??##.?? 1,3\r\n?#.?.?#?.?#####????. 2,1,2,7\r\n???.????#?#??? 2,9\r\n??????#?.# 1,1,1\r\n???????????????????# 1,2,1,2,3,1\r\n?.??.?????#??#??#?. 1,2,4,8\r\n??#??????#?#??? 3,2,1,4\r\n.????????.???????? 4,1,1,2,1\r\n??????##?????????.?? 14,1\r\n.????.???????? 1,7\r\n??..?????##?.??#?? 2,7,4\r\n?..#?..???? 2,3\r\n.?.???.#???#?#????. 1,1,8\r\n?????.?.????????? 1,1,8\r\n??.??.??.#??? 1,2,1,4\r\n???.?###???? 2,3,1\r\n?#?????#???.????. 1,5,2\r\n.????#??.?????#?. 4,4\r\n???..?#?????.?. 2,3,3\r\n?##?.??.?#?????#? 4,1,4,3\r\n?????..#????##?? 1,1,1,6\r\n?.??##???..?#?.???? 5,3\r\n.????????#??????.?? 1,10,1\r\n.#?.?????#??# 1,7\r\n?##?##???.???#. 6,1,1,1\r\n?#??.#.?????#?#?. 1,1,1,1,6\r\n?#?###??.#??##?? 7,5,1\r\n.??#??????#?.?#????? 10,5\r\n?#.#??????????#???# 2,2,1,3,3,1\r\n???????????? 2,1,1,4\r\n.#?????##??#???# 1,5,1,3\r\n??..?.??????.?????. 2,3\r\n?#??.??????.#?#????? 2,3,3,1\r\n???#.????##???? 1,8\r\n???????#???#?#??. 1,1,8,1,1\r\n??????.??? 5,1\r\n?.?..??.#??#?#?? 1,1,1,7\r\n.#??##??#??? 6,1,1\r\n.?#.?...?? 2,1,1\r\n??#?##?#?????#???? 14,1\r\n..?#?.?#.????#?? 2,2,4\r\n.???.????.????#?? 2,1,1,1,3\r\n#.???????#??##???# 1,1,1,9,1\r\n??.???#?.. 2,5\r\n?#???#?.??????.???? 3,1,1,1,1,2\r\n.??#.???.#?#? 1,1,2,3\r\n.?#?.#???#. 2,1,1\r\n.?##?##?.?#..???.#?? 7,2,3,1,1\r\n?#????#??#??#.#.?. 1,9,1,1\r\n??.????????????? 2,1,1,2,4\r\n?.????????? 1,1,6\r\n????.#?????#??? 1,1,1,2,2\r\n.??#??.#??.??.?? 1,1,1,2,2\r\n#????????#??# 1,1,3,1\r\n???.?#??.##?? 3,3\r\n?##?#####???. 8,2\r\n????????????##???.?# 10,2,2,2\r\n??.?#.??????.? 1,1,1\r\n?????#.##???.?#??? 3,2,5,3\r\n???.?#????#?.? 1,8\r\n?.##?#???.#??.?.? 6,1,1\r\n???.??#?#???##.?.?? 2,4,4,1\r\n.#??##???#???? 6,4\r\n??....???. 1,3\r\n#??#??.?????? 5,1,2\r\n??????.?#.??..??? 1,1,2,1,2\r\n#??.????????.#?. 3,1,1,4,2\r\n#?.??.????? 1,1,4\r\n?##?.?#.?? 2,1\r\n?.?.##????.?. 1,1,6,1\r\n?????????? 1,1,1\r\n#???.?#?#????????..? 4,9,1,1\r\n????#???##??.? 6,2\r\n?##?????.#???# 3,2,5\r\n???#???#.? 2,1,1\r\n?.??????##.???.. 3,2\r\n?#?.?????? 1,1,2\r\n???.?#?##???#???? 1,6,1,1\r\n#?#.#.#..??.# 3,1,1,1\r\n.??????????? 5,4\r\n??#.?????##??? 3,2,2\r\n????#?#???##???.??? 14,3\r\n#.##????#?.#??.???? 1,7,1,2\r\n???#????#??????? 4,6,2\r\n?.##?#?.?????##? 2,1,7\r\n??.????#?#?????.? 1,1,4,3\r\n#.????.?#? 1,1,3\r\n.?#????##???.???? 1,7,2\r\n.#.?????#??##?# 1,11\r\n??????#??.#? 1,1,1,2\r\n??..#???.?? 2,1,1\r\n??###??#???????.???# 12,1,3\r\n.?#??#.#??????#??#?? 4,1,1,3,1,1\r\n??#??.????? 3,1,1\r\n.?..?????#????#?##?? 2,10\r\n?????????##??. 1,1,5\r\n?????#?#??#?????? 4,1,2,3\r\n#????.???? 1,3,3\r\n?.??#?????#?? 1,9\r\n?...#.??##???? 1,1,4\r\n?..?#.#????????.? 2,1,6,1\r\n#?#??#?.??????#??# 1,1,2,4,3,1\r\n????#?????.?.?? 1,5,1,1,1\r\n????.??#?.#?.?? 4,1,1,2,1\r\n?????????.?###? 7,4\r\n.#?#?#.?.?.????? 3,1,1,1,2\r\n???##.?.##? 2,2\r\n?#.?#.?#???##? 1,1,2,3\r\n?.????#???? 1,2,5\r\n?.?##.??#???.???? 1,3,5,1,1\r\n???..??##?? 2,4,1\r\n.????.????. 2,4\r\n????####..#???.??? 7,3,3\r\n???#???.##?.??#?#? 1,1,1,3,5\r\n??#??##?.? 1,3\r\n??#??????? 2,2\r\n#??..??????? 2,4\r\n?.??.?.???#??#?##?#? 1,1,1,10\r\n????.?#?.?#??#? 2,3,5\r\n?????????????#.?? 5,1,1,4,1\r\n?#?..?#.?.?? 2,2,2\r\n..#.?????? 1,4\r\n?.??##??????..??? 6,2\r\n??????#???? 3,1,1\r\n.?????????#???# 10,1,1\r\n????#?.#.?.???? 1,2,1,1,1\r\n?.#??.????#. 1,2,3,1\r\n??.#????.??#?????#?? 1,1,1,9\r\n???.????#..???. 1,1,5,1\r\n#???????#. 1,2,1\r\n??????#???#?##?#? 1,1,1,7\r\n??.?###???.?? 1,4,1,2\r\n.??#?#?..???#.??### 3,1,4,4\r\n.?###???.??#... 6,3\r\n?#?.??????#?###?#?? 2,7,7\r\n?#??????.??????.. 7,1,1,1\r\n.??????.??.???#?.# 1,1,1,2,2,1\r\n???.??.#???? 1,1,1,1\r\n???#???#??.?????? 1,1,4,2,1\r\n#?#.??#?#???#??? 3,1,1,1,3\r\n?#????????.#..????? 4,1,1,1,4\r\n??..???.?.? 1,3,1\r\n.????...??#????#.?. 2,1,1\r\n?????#??????#???? 6,7\r\n?.??#?#???? 1,5,2\r\n?..??#.???? 3,2\r\n???##???##??#? 1,2,5\r\n?.????????.#??#?.? 1,8,1,1,1\r\n#??#????###?.???.? 5,6,1,1\r\n????#?#?#?#???.??# 13,2\r\n???#?#??#?? 3,4\r\n??..?#???#????..? 1,4\r\n??#..?.????.???? 1,1,3,1,1\r\n?#??..??.???????.? 3,1,2,2,1\r\n?????#???? 2,3,1\r\n????#?#???.?#.#?#??? 1,6,1,1,6\r\n#?##?#?#??????. 4,1,1,4\r\n#?#.???#??? 3,2\r\n.??.??.???#?#.?.? 1,3\r\n???#?????#?? 1,3,1,1\r\n.???????#? 4,2\r\n???#?????.?????.. 1,4,1,1,2\r\n???????????#?# 2,1,5\r\n?.???.??..????.?.. 2,2\r\n???.?????#?.????? 1,1,1,4,3\r\n??.??????#???.?? 2,1,1,4,1\r\n??#??.#.?.?##?#??? 4,1,1,7\r\n?#???#?.???#??.#??#? 6,3,4\r\n??#?.?????????. 4,2,2,2\r\n??#????...##? 5,2\r\n?#???##.??.???#?#. 6,1,5\r\n????????#???#??.? 3,10\r\n???.?#??.???##? 2,2,4\r\n?..?????## 1,6\r\n#??#.#?##???#?? 1,2,1,3,3\r\n?##.????##?.?##. 3,3,3,3\r\n???.???..#??..?.?#? 2,1,1,1,1,2\r\n?#?##????#? 1,8\r\n.??#??#?##?## 1,1,8\r\n.#??..????..#.????? 1,1,1,1,1,5\r\n???????.?#??# 5,3,1\r\n#???#...?? 5,1\r\n.???###??????? 5,1\r\n?#?.?#?..#?#?#???? 1,2,1,1,2,1\r\n#??#???.?????.??? 6,3,1,1,1\r\n????#??.?. 1,2,1\r\n????.??#.?.???#??? 1,1,2,1,1,3\r\n#.???????##?????? 1,10,1,1\r\n?.??.???##???#.? 2,8\r\n?.#???.??#?? 3,2,1\r\n?#?.?#???. 2,4\r\n.???.#?..?#???##???? 1,2,2,7\r\n?#???????? 3,4\r\n?#???.?#?? 1,2,4\r\n?????#.??? 6,2\r\n??.???.?#? 1,2,2\r\n..#?????????#.?#?#?# 5,4,5\r\n#????#??#???? 2,1,4\r\n..??.???.???#??? 2,7\r\n??#??..??.???.?? 5,1,1,1\r\n.?#??#?#.?..#?#.? 7,3\r\n...?#?#?????#.?#? 2,7,2\r\n??..???.?????????.? 2,2,1,4\r\n???.?#???.? 1,3\r\n?#?#?.???##???# 3,5,2\r\n##?#.?##?.#? 4,3,2\r\n.?????##?# 1,5,1\r\n?.???#??#?#?? 1,7\r\n.????##??????.? 12,1\r\n???????.?.? 1,3\r\n?#.???##????..???#?. 2,6,1,4\r\n#???##?#..?????. 1,5,1,1\r\n#??##.???.????.? 1,3,1,1\r\n?.????#..??#??? 3,2\r\n.??????#??... 4,1\r\n.???#.?.??? 2,1\r\n?#??#??#?#????##?? 2,1,11\r\n.?#???..?.??.... 3,1,2\r\n???#??#??????#??? 1,2,2,3,4\r\n.###?????###.???? 11,4\r\n#?#?..#?#???#??????? 4,7,1,1\r\n????????????#?.. 6,3\r\n.#.??..????. 1,1,2,1\r\n?.#??#?#?#?#.?? 1,8,1\r\n.???#??##?????. 1,9\r\n#???????#? 2,1,3\r\n???#?#.?.?.???? 3,1,1,2\r\n.##???#??.??.#???# 8,5\r\n#?##??????????? 1,7,1\r\n??????????.??.?#? 7,1,1,3\r\n#????#????##?????? 13,1,1\r\n#??#????.?.?.?? 1,6,1,1\r\n?#??###???#? 1,8\r\n?????#..?? 2,3,1\r\n.??????.??????. 1,1,5\r\n???.?..???. 2,1\r\n???????#???##?#?? 3,2,5\r\n??????##??# 1,3,1\r\n#??..?#???. 3,5\r\n??#??#??#?#???#????? 15,1\r\n??.???.???###? 2,3\r\n?????????.???#. 2,5,3\r\n.???????..??#? 1,1,1,2\r\n????#?#.?.???.?? 6,1,1,1,1\r\n?.??????.?.## 1,4,1,2\r\n?#??#?#?.##??#?##??? 1,3,11\r\n????##???.. 1,2,1\r\n????.?.????#????#?#? 3,1,1,1,1,3\r\n???.?.????#??.? 1,6\r\n??##??????# 6,1,1\r\n??.?.????##?????. 2,1,2,2\r\n???...??????? 2,1\r\n.?????###???.????.. 9,1\r\n??.?#?.?.?##. 1,3\r\n??#???#.??.# 1,5,1\r\n??.????????? 1,5\r\n???#???.?.#??????.?# 6,1,1,3,1,2\r\n?????#.???##??.?. 1,1,1,7,1\r\n?.??#?#??#?..?#??. 1,4,2,2,1\r\n????????#????#??.?. 2,10\r\n????##???#???.???? 5,3,3\r\n#.#.?##??#?????#? 1,1,7,1,1\r\n#?????##??????? 1,1,6,1\r\n#.??#?.??..#.??#..?? 1,4,1,1,3,1\r\n#???#?#??#.?##? 1,5,1,2\r\n#.?##???#.?.??#. 1,6,1,1,1\r\n???.?.???? 1,1,1\r\n?#?#???.?? 4,1,1\r\n###?##?..???##?? 6,2\r\n?.#.?#??####???#?. 1,8,2\r\n#??.????#??? 1,1,3,2\r\n#?#??..#????#?? 1,1,1,1,3\r\n.???#?#???# 2,5,1\r\n?#?##???.???? 4,1,1\r\n?#?.???##??#??????? 2,8,1,1\r\n?????.???????.??##?? 2,1,6,3\r\n..????.#?#?? 2,4\r\n.?#???????#.??? 1,1,2,1,1\r\n??#?..#?#??..????? 2,4,4\r\n??.?.?..?? 2,1\r\n#??#???##??.??#? 5,5,2\r\n???#????.???? 5,1,1\r\n#???.??#?##?#.#..? 2,1,1,6,1,1\r\n.?#?##????????.? 1,3,2,1\r\n.#?#??.?.? 4,1\r\n??.???#?????????? 1,11\r\n.###????###????. 3,6,1\r\n??#????.?##? 4,3\r\n???.?###???# 1,8\r\n???.???.#???#?.? 1,1,5,1\r\n??##????????#?? 5,2,3\r\n#?#?#????#?##..#???? 1,1,9,1,2\r\n#??.##???.??? 1,2,1,1\r\n?..#?????. 1,3,1\r\n.???#?#??##????#??? 12,2\r\n#??????.??#? 7,3\r\n??#.?#?.#????#?.# 2,1,2,3,1\r\n?#?.?.???????? 2,7\r\n??.??#?#?.????????? 1,4,9\r\n.??.???##? 2,1,2\r\n.??????#.?.?????. 1,1,1,1\r\n???#.???#???#..? 1,1,8,1\r\n.????#???? 1,1,1\r\n?#.??.??????????#.? 1,1,2,5,1\r\n?.?.???.?. 1,1\r\n???.?.#???????#?#?#. 1,1,1,7,1,3\r\n??.?????#??## 1,1,1,2\r\n.????????? 3,2\r\n#?????????#????#. 6,4,2\r\n#??.?##???.??? 1,3,1,2\r\n??.???##?#? 4,2\r\n?#.?????.?.??#?.?. 1,2,1,1,4,1\r\n?????..??.?? 1,1,1,1\r\n#???#???#???? 2,1,5\r\n?.???..?????.?? 3,5\r\n??#..#?????????? 3,1,2,3\r\n#?????###???..?#? 1,1,4,1,1\r\n?##?#?.#?#? 5,4\r\n?##???#??..#??#? 9,1,1\r\n???#???##??????. 4,4\r\n??#???#??#.???#? 3,4,1,1,1\r\n?#?#??.?##?#??#?. 5,8\r\n?.???.?#???.????.. 1,1,5,3\r\n.???.?.?#??? 2,1,1,1\r\n###?.????.?????? 3,1,1,1,1\r\n????#??#???.?##???? 2,2,2,5\r\n???????#.?.?#? 1,4,1,1\r\n???????##?##?????#. 11,1,1\r\n.???#.?#?????### 1,2,1,1,5\r\n??????#????#..?? 8,1,1\r\n#?????#?..???.#? 8,2,1\r\n???#???##???? 1,3,2,2\r\n???????#????.??? 5,1,1,1\r\n?##..???#?? 3,5\r\n.??????#????.? 7,1\r\n?#?#?#???.??#??.?? 8,3\r\n?????##???#? 5,1\r\n??#?.??????#.?? 3,2,1,2,1\r\n.#?????.???..???..?. 5,2\r\n????#??????? 5,1\r\n?.?#??#?###?# 1,10\r\n????#?????.#??..? 5,3\r\n???#?#??.? 2,1,1\r\n.????.???#??? 3,1,3\r\n#?#?#????????. 1,1,1,6\r\n#.?##?#???##??#???? 1,5,2,1,1\r\n????.##??#???#??#? 1,9,2\r\n???#?#?#?#?.?# 8,2,1\r\n??#???#????#????#?.? 9,5,2\r\n#.????????#?. 1,1,1,2\r\n?????..????.???#?. 5,2,3\r\n????.??.?#.? 1,1,1,1\r\n???#??#?.??? 4,1\r\n???#???#?#??#?????? 1,1,4,2,1,1\r\n.?##??..?. 2,1\r\n?#####?????#??.??? 13,2\r\n???.#??#?#??#??. 1,1,7\r\n.???#?????#?#??.?#?# 12,3\r\n?...#...##. 1,2\r\n?.#????????.#?.?.?? 5,2,1,1,1\r\n?#???..#??? 3,1\r\n??.#?????????????#?? 1,1,6,1,1,1\r\n?.?..??#?..????? 1,1,4,1,3\r\n???.??.?#??.#.? 3,1,2,1,1\r\n?#?##??????#??? 1,2,3,3,1\r\n?#???.?.?#??.?#? 3,1,3,1\r\n##??.???.? 3,1\r\n.?.??????? 1,3\r\n?????#?#??.?????## 1,1,1,1,1,6\r\n..????.??..?? 1,2,1,1\r\n??#??.??#????? 4,4,1\r\n??.??.???#?? 1,3\r\n?????#?#???#? 1,1,3,1\r\n??.?..##???? 1,3\r\n.?.???.#?? 1,1,1\r\n?#????##??##???.#??# 4,2,6,1,1\r\n??.#?#?.???##...???? 1,4,4,3\r\n??.?#???.??? 4,1\r\n?#???#?.#???? 6,1,1";
            InputData = "???.### 1,1,3\r\n.??..??...?##. 1,1,3\r\n?#?#?#?#?#?#?#? 1,3,1,6\r\n????.#...#... 4,1,1\r\n????.######..#####. 1,6,5\r\n?###???????? 3,2,1";   // Exemple donné pour debug
            #endregion

            InitInputData(InputData);

            foreach (string ligne in Lines)
            {
                InitialisationLigne(ligne);
            }
            if (this.Debug)
                DebugInit();
        }
        #endregion

        #region Initialisation
        /// <summary>
        /// Initialisation des données de travail pour une ligne.
        /// </summary>
        /// <param name="ligne">Données de la ligne d'entrée</param>
        private void InitialisationLigne(string ligne)
        {
            string s = ligne.ToString();
            while (s.Contains("..")) s = s.Replace("..", ".");
            
            SpringMap.Add(new SpringLine(s));
            SpringMapPt2.Add(new SpringLine(s, true));
        }
        #endregion

        #region Méthodes publiques
        public override long Partie1()
        {
            return ProcessPart1();
        }

        public override long Partie2()
        {
            return ProcessPart2();
        }
        #endregion

        #region Process
        private long ProcessPart1()
        {
            return SpringMap.Sum(sm=>sm.CalculatePossibilities());
        }
        private long ProcessPart2()
        {
            SpringMapPt2.Select(sm => sm.CalculatePossibilitiesPt2()).ToList();
            return SpringMapPt2.Sum(sm => sm.CalculatePossibilitiesPt2());
        }
        #endregion

        #region Debug
        private void DebugInit()
        {
        }
        #endregion

        #region Classes de travail
        private class SpringLine
        {
            private string Line { get; set; }
            private List<int> Criteres { get; set; }
            private Regex Validation { get; set; }
            private Dictionary<string, long> Memo { get; set; } = new Dictionary<string, long>();
            private Dictionary<int, Dictionary<int, long>> Memo2 { get; set; } = new Dictionary<int, Dictionary<int, long>>();
            private List<int> Unknowns { get; set; }
            public SpringLine(string Line, bool Pt2 = false)
            {
                var Split = Line.Split(' ');
                this.Line = Split[0];
                Criteres = Split[1].Split(',').Select(int.Parse).ToList();

                if (Pt2)
                {
                    this.Line += "?" + Split[0] + "?" + Split[0] + "?" + Split[0] + "?" + Split[0];
                    List<int> Temp = Criteres.ToList();
                    Criteres.AddRange(Temp);
                    Criteres.AddRange(Temp);
                    Criteres.AddRange(Temp);
                    Criteres.AddRange(Temp);
                    Criteres.Select((c, i) => i).ToList().ForEach(i => Memo2.Add(i, new Dictionary<int, long>()));
                }

                string regex = "^\\.*#{" + string.Join("}\\.+#{", Criteres) + "}\\.*$";
                Validation = new Regex(regex);
                Unknowns = this.Line.Select((v, i) => new { index = i, valeur = v }).Where(c => c.valeur == '?').Select(c => c.index).ToList();
            }
            public long Test2 (string stringTemp, int indexCritere, int indexLine)
            {
                if (indexCritere >= Criteres.Count)
                    return 1;

                if (Memo2[indexCritere].TryGetValue(indexLine, out long nb))
                {
                    return nb;
                }


                long Nb = 0;
                Regex valid = new Regex("^\\.*#{" + string.Join("}\\.+#{", Criteres.Take(indexCritere + 1)) + "}" + (indexCritere < Criteres.Count - 1 ? "\\." : ""));
                int NbCharDroite = Criteres.Select((v, i) => i > indexCritere ? v + 1 : 0).Sum() - 1;

                var UnknownsTemp = Unknowns.Where(u => u <= stringTemp.Length - NbCharDroite && u >= indexLine).ToList();


                var match = valid.Match(stringTemp);
                if (match.Success)
                {
                    Nb = Test2(stringTemp, match.Length, indexCritere + 1);

                }
                for(int step = 1; step <= Math.Min(Criteres[indexCritere], UnknownsTemp.Count); step++)
                {
                    var res = GenerateCombinations(UnknownsTemp.Count, step);

                    foreach (var comb in res)
                    {
                        string possibilite = "";
                        List<int> positions = comb.Select(c => UnknownsTemp[c]).ToList();
                        for (int i = 0; i < this.Line.Length; i++)
                        {
                            if (positions.Contains(i))
                            {
                                possibilite += '#';
                            }
                            else
                            {
                                possibilite += stringTemp[i];
                            }
                        }

                        match = valid.Match(possibilite);
                        if (match.Success)
                        {
                            Nb += Test2(possibilite, match.Length, indexCritere + 1);

                        }
                    }
                }

                Memo2[indexCritere].Add(indexLine, Nb);
                return 0;
            }

            public long Test(string stringTemp, int indexLine, int indexCritere)
            {
                if(Memo.TryGetValue(indexLine+"-"+indexCritere, out long nb))
                {
                    return nb;
                }

                if (indexCritere >= Criteres.Count)
                    return 1;

                long Nb = 0;
                Regex valid = new Regex("^\\.*#{" + string.Join("}\\.+#{", Criteres.Take(indexCritere + 1)) + "}" + (indexCritere < Criteres.Count - 1 ? "\\." : ""));
                int NbCharDroite = Criteres.Select((v,i)=> i > indexCritere ? v+1 : 0).Sum() - 1;

                var UnknownsTemp = Unknowns.Where(u => u <= stringTemp.Length - NbCharDroite && u >= indexLine).ToList();

                var match = valid.Match(stringTemp);
                if (match.Success)
                {
                    Nb = Test(stringTemp, match.Length, indexCritere + 1);

                }

                for(int step = 1; step <= Criteres[indexCritere]; step++)
                {
                    var res = GenerateCombinations(UnknownsTemp.Count, step);

                    foreach (var comb in res)
                    {
                        string possibilite = "";
                        List<int> positions = comb.Select(c => UnknownsTemp[c]).ToList();
                        for (int i = 0; i < this.Line.Length; i++)
                        {
                            if (positions.Contains(i))
                            {
                                possibilite += '#';
                            }
                            else
                            {
                                possibilite += stringTemp[i];
                            }
                        }

                        match = valid.Match(possibilite);
                        if (match.Success)
                        {
                            Nb += Test(possibilite, match.Length, indexCritere + 1);

                        }
                    }
                }
                Memo.Add(indexLine + "-" + indexCritere, Nb);

                return Nb;
            }

            public long CalculatePossibilitiesPt2()
            {
                string strTemp = this.Line.Replace('?', '.');
                return Test2(strTemp, 0, 0);
            }
            public long CalculatePossibilities()
            {
                List<string> possibilites = new List<string>();

                int nbD = Criteres.Sum() - this.Line.Count(c => c == '#');
                List<int> unknowns = Line.Select((v,i)=>new {index = i, valeur = v}).Where(c=>c.valeur == '?').Select(c=>c.index).ToList();

                var res = GenerateCombinations(unknowns.Count, nbD);
                string temp = this.Line.Replace('?', '.').ToString();
                foreach (var comb in res)
                {
                    string pos = "";
                    List<int> positions = comb.Select(c => unknowns[c]).ToList();
                    for(int i = 0; i < temp.Length; i++)
                    {
                        if(positions.Contains(i))
                        {
                            pos += '#';
                        }
                        else
                        {
                            pos += temp[i];
                        }
                    }
                    if(Validation.IsMatch(pos))
                        possibilites.Add(pos);
                }
                Console.WriteLine(possibilites.Count);
                return possibilites.Count;
            }


            private List<int[]> GenerateCombinations(int p, int n)
            {
                List<int[]> combinationsList = new List<int[]>();
                int[] currentCombination = new int[n];

                GenerateCombinationsHelper(combinationsList, currentCombination, p, n, 0, 0);

                return combinationsList;
            }

            private void GenerateCombinationsHelper(List<int[]> combinationsList, int[] currentCombination, int p, int n, int currentIndex, int startValue)
            {
                if (currentIndex == n)
                {
                    // Add a copy of the current combination to the list
                    int[] copy = new int[n];
                    Array.Copy(currentCombination, copy, n);
                    combinationsList.Add(copy);
                    return;
                }

                for (int i = startValue; i < p; i++)
                {
                    currentCombination[currentIndex] = i;
                    GenerateCombinationsHelper(combinationsList, currentCombination, p, n, currentIndex + 1, i + 1);
                }
            }
        }
        private class Springs : List<SpringLine>
        {

        }
        #endregion
    }
}
